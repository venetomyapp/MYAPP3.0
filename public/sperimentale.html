<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Adesione Online - SIM Carabinieri</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Space+Grotesk:wght@700;900&display=swap" rel="stylesheet">
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Inter', sans-serif;
    background: linear-gradient(135deg, #003d82 0%, #4a1f5c 50%, #8b2635 100%);
    min-height: 100vh;
    padding: 20px;
    position: relative;
}

/* Elementi decorativi background */
body::before {
    content: '';
    position: fixed;
    top: -50%;
    right: -20%;
    width: 600px;
    height: 600px;
    background: radial-gradient(circle, rgba(255, 215, 0, 0.08) 0%, transparent 70%);
    border-radius: 50%;
    z-index: 0;
}

body::after {
    content: '';
    position: fixed;
    bottom: -30%;
    left: -15%;
    width: 500px;
    height: 500px;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.05) 0%, transparent 70%);
    border-radius: 50%;
    z-index: 0;
}

.container {
    max-width: 800px;
    margin: 0 auto;
    background: white;
    border-radius: 16px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
    overflow: hidden;
    position: relative;
    z-index: 1;
}

.header {
    background: linear-gradient(135deg, #003d82 0%, #4a1f5c 50%, #8b2635 100%);
    color: white;
    padding: 35px 30px;
    text-align: center;
    position: relative;
    overflow: hidden;
}

.header::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -10%;
    width: 300px;
    height: 300px;
    background: radial-gradient(circle, rgba(255, 215, 0, 0.15) 0%, transparent 70%);
    border-radius: 50%;
}

.logo-section {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    margin-bottom: 20px;
    position: relative;
    z-index: 2;
}

.logo {
    width: 60px;
    height: 60px;
    filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.3));
}

.logo img {
    width: 100%;
    height: 100%;
    object-fit: contain;
}

.brand-text {
    display: flex;
    flex-direction: column;
    gap: 3px;
    text-align: left;
}

.brand-name {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 24px;
    font-weight: 900;
    color: #FFD700;
    text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    letter-spacing: 1.5px;
}

.brand-hashtag {
    font-family: 'Inter', sans-serif;
    font-size: 12px;
    font-weight: 600;
    color: rgba(255, 255, 255, 0.9);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.header h1 {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 28px;
    font-weight: 900;
    margin-bottom: 8px;
    position: relative;
    z-index: 2;
    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
}

.header p {
    font-size: 15px;
    font-weight: 600;
    opacity: 0.95;
    position: relative;
    z-index: 2;
}

.progress-bar {
    background: rgba(255, 255, 255, 0.2);
    height: 8px;
    border-radius: 4px;
    margin-top: 20px;
    overflow: hidden;
    position: relative;
    z-index: 2;
}

.progress-fill {
    background: #FFD700;
    height: 100%;
    transition: width 0.3s ease;
    box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
}

.content {
    padding: 40px;
}

.step {
    display: none;
    animation: fadeIn 0.3s ease;
}

.step.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.question {
    font-size: 20px;
    font-weight: 700;
    color: #003d82;
    margin-bottom: 30px;
    font-family: 'Space Grotesk', sans-serif;
}

.form-group {
    margin-bottom: 25px;
}

.conditional-field {
    display: none;
    animation: fadeIn 0.3s ease;
}

.conditional-field.show {
    display: block;
}

label {
    display: block;
    font-weight: 600;
    color: #374151;
    margin-bottom: 8px;
    font-size: 14px;
}

input[type="text"],
input[type="email"],
input[type="tel"],
input[type="date"],
select {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    font-size: 16px;
    transition: all 0.2s;
    font-family: inherit;
}

input:focus,
select:focus {
    outline: none;
    border-color: #FFD700;
    box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2);
}

.radio-group {
    display: flex;
    gap: 20px;
    margin-top: 15px;
}

.radio-option {
    flex: 1;
    position: relative;
}

.radio-option input[type="radio"] {
    position: absolute;
    opacity: 0;
}

.radio-option label {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 18px;
    font-weight: 600;
}

.radio-option input:checked + label {
    background: linear-gradient(135deg, #003d82 0%, #4a1f5c 100%);
    color: white;
    border-color: #FFD700;
    box-shadow: 0 4px 15px rgba(0, 61, 130, 0.3);
}

.row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

.signature-area {
    border: 2px dashed #cbd5e1;
    border-radius: 8px;
    padding: 20px;
    text-align: center;
    margin-bottom: 20px;
    background: #f8fafc;
}

.signature-wrapper {
    max-width: 600px;
    margin: 15px auto;
}

#signature-canvas {
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    cursor: crosshair;
    background: white;
    display: block;
    width: 100%;
    touch-action: none;
}

.upload-area {
    border: 2px dashed #cbd5e1;
    border-radius: 8px;
    padding: 30px;
    text-align: center;
    margin-bottom: 20px;
    cursor: pointer;
    transition: all 0.2s;
}

.upload-area:hover {
    border-color: #FFD700;
    background: #fffef5;
}

.upload-area input[type="file"] {
    display: none;
}

.preview-box {
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    padding: 10px;
    text-align: center;
}

.preview-box img {
    max-width: 100%;
    height: auto;
    border-radius: 4px;
}

.buttons {
    display: flex;
    justify-content: space-between;
    margin-top: 30px;
    gap: 15px;
}

button {
    padding: 14px 28px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    font-family: inherit;
}

.btn-primary {
    background: linear-gradient(135deg, #003d82 0%, #4a1f5c 100%);
    color: white;
    flex: 1;
    border: 2px solid transparent;
    position: relative;
    overflow: hidden;
}

.btn-primary::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.3), transparent);
    transition: left 0.5s;
}

.btn-primary:hover::before {
    left: 100%;
}

.btn-primary:hover {
    background: linear-gradient(135deg, #004d9f 0%, #5a2f6c 100%);
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0, 61, 130, 0.4);
}

.btn-primary:disabled {
    background: #cbd5e1;
    cursor: not-allowed;
    transform: none;
}

.btn-secondary {
    background: rgba(0, 61, 130, 0.1);
    color: #003d82;
    border: 2px solid #003d82;
    font-weight: 700;
}

.btn-secondary:hover {
    background: rgba(0, 61, 130, 0.2);
    border-color: #4a1f5c;
}

.btn-success {
    background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
    color: #003d82;
    font-weight: 800;
    box-shadow: 0 8px 20px rgba(255, 215, 0, 0.4);
}

.btn-success:hover {
    background: linear-gradient(135deg, #FFA500 0%, #FF8C00 100%);
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(255, 165, 0, 0.5);
}

.btn-download {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
    font-weight: 700;
    padding: 12px 20px;
    margin: 5px;
    display: inline-block;
}

.btn-download:hover {
    background: linear-gradient(135deg, #059669 0%, #047857 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(16, 185, 129, 0.4);
}

.summary {
    background: #f8fafc;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
}

.summary h3 {
    color: #1f2937;
    margin-bottom: 15px;
}

.summary-item {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid #e5e7eb;
}

.summary-label {
    font-weight: 600;
    color: #6b7280;
}

.summary-value {
    color: #1f2937;
}

.alert {
    background: #fef3c7;
    border: 2px solid #fbbf24;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 20px;
    color: #92400e;
}

.success-message {
    text-align: center;
    padding: 40px;
}

.success-message h2 {
    color: #003d82;
    font-size: 28px;
    margin-bottom: 20px;
    font-family: 'Space Grotesk', sans-serif;
    font-weight: 900;
}

.checkmark {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
    margin: 0 auto 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 40px;
    color: #003d82;
    box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
    font-weight: 900;
}

small {
    display: block;
    color: #6b7280;
    font-size: 12px;
    margin-top: 5px;
}

.loading-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.8);
    z-index: 9999;
    align-items: center;
    justify-content: center;
}

.loading-content {
    background: white;
    padding: 40px;
    border-radius: 12px;
    text-align: center;
}

.spinner {
    border: 4px solid #f3f4f6;
    border-top: 4px solid #FFD700;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: spin 1s linear infinite;
    margin: 0 auto 20px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.manual-download-section {
    background: #f0fdf4;
    border: 2px solid #10b981;
    border-radius: 12px;
    padding: 20px;
    margin: 20px 0;
}

/* RESPONSIVE MOBILE */
@media (max-width: 768px) {
    body {
        padding: 10px;
    }
    
    .container {
        border-radius: 8px;
    }
    
    .header {
        padding: 20px 15px;
    }
    
    .logo-section {
        gap: 12px;
        margin-bottom: 15px;
    }
    
    .logo {
        width: 50px;
        height: 50px;
    }
    
    .brand-name {
        font-size: 18px;
    }
    
    .brand-hashtag {
        font-size: 10px;
    }
    
    .header h1 {
        font-size: 20px;
    }
    
    .header p {
        font-size: 14px;
    }
    
    .progress-bar {
        margin-top: 15px;
        height: 6px;
    }
    
    .content {
        padding: 20px 15px;
    }
    
    .question {
        font-size: 18px;
        margin-bottom: 20px;
    }
    
    .row {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    input[type="text"],
    input[type="email"],
    input[type="tel"],
    input[type="date"],
    select {
        font-size: 16px;
        padding: 14px;
    }
    
    .radio-group {
        flex-direction: column;
        gap: 12px;
    }
    
    .radio-option label {
        padding: 18px;
        font-size: 16px;
    }
    
    button {
        padding: 16px 24px;
        font-size: 16px;
    }
    
    .buttons {
        flex-direction: column;
        gap: 12px;
    }
    
    .btn-primary,
    .btn-secondary,
    .btn-success {
        width: 100%;
    }
    
    .btn-download {
        width: 100%;
        margin: 5px 0;
    }
    
    #signature-canvas {
        width: 100%;
        height: 150px;
    }
    
    .signature-wrapper {
        max-width: 100%;
    }
    
    .upload-area {
        padding: 20px;
    }
    
    .upload-area p {
        font-size: 16px;
    }
    
    .upload-area small {
        font-size: 13px;
    }
    
    .preview-box {
        margin-bottom: 15px;
    }
    
    .summary {
        padding: 15px;
    }
    
    .summary-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
        padding: 10px 0;
    }
    
    .summary-label,
    .summary-value {
        font-size: 14px;
    }
    
    .summary h3 {
        font-size: 18px;
    }
    
    .success-message {
        padding: 20px 10px;
    }
    
    .success-message h2 {
        font-size: 24px;
    }
    
    .checkmark {
        width: 60px;
        height: 60px;
        font-size: 30px;
    }
    
    #download-list {
        width: 100%;
        padding: 15px !important;
        font-size: 14px;
    }
    
    #download-list h4 {
        font-size: 16px;
    }
    
    #download-list li {
        font-size: 14px !important;
    }
    
    .success-message > div[style*="background: #dbeafe"] {
        padding: 20px 15px !important;
        margin: 20px 0 !important;
    }
    
    .success-message > div[style*="background: #dbeafe"] p {
        font-size: 14px !important;
    }
    
    #email-button {
        font-size: 16px !important;
        padding: 14px !important;
    }
    
    .signature-area {
        padding: 15px 10px;
    }
    
    .signature-area p,
    .signature-area small {
        font-size: 14px;
    }
    
    .signature-area button {
        width: 100%;
        margin-top: 15px !important;
    }
    
    .loading-content {
        padding: 30px 20px;
        margin: 0 15px;
    }
    
    .loading-content h3 {
        font-size: 18px;
    }
    
    .spinner {
        width: 40px;
        height: 40px;
    }
    
    .alert {
        padding: 12px;
        font-size: 14px;
    }
    
    small {
        font-size: 11px;
    }
    
    label {
        font-size: 13px;
    }
    
    .conditional-field {
        margin-top: 15px;
    }
    
    ::placeholder {
        font-size: 14px;
    }
}

@media (max-width: 480px) {
    .logo {
        width: 40px;
        height: 40px;
    }
    
    .brand-name {
        font-size: 16px;
    }
    
    .brand-hashtag {
        font-size: 9px;
    }
    
    .header h1 {
        font-size: 18px;
    }
    
    .header p {
        font-size: 13px;
    }
    
    .question {
        font-size: 16px;
    }
    
    .content {
        padding: 15px 10px;
    }
    
    input[type="text"],
    input[type="email"],
    input[type="tel"],
    input[type="date"],
    select {
        font-size: 16px !important;
        padding: 12px;
    }
    
    .radio-option label {
        font-size: 14px;
        padding: 14px;
    }
    
    button {
        font-size: 14px;
        padding: 14px 20px;
    }
    
    #signature-canvas {
        height: 120px;
    }
    
    .checkmark {
        width: 50px;
        height: 50px;
        font-size: 24px;
    }
    
    .success-message h2 {
        font-size: 20px;
    }
    
    .success-message p {
        font-size: 14px;
    }
}

/* Media query per rendere i 3 pulsanti Email/WhatsApp/Telegram in verticale su mobile */
@media (max-width: 600px) {
    /* Box con 3 pulsanti diventa verticale */
    div[style*="grid-template-columns: repeat(3, 1fr)"] {
        grid-template-columns: 1fr !important;
    }
    
    /* Padding ridotto per box su mobile */
    .container {
        padding: 10px;
    }
    
    /* Row diventa verticale su mobile */
    .row {
        flex-direction: column;
    }
}
</style>
</head>
<body>

<div class="loading-overlay" id="loading">
    <div class="loading-content">
        <div class="spinner"></div>
        <h3>Generazione PDF in corso...</h3>
        <p>Attendere prego</p>
    </div>
</div>

<div class="container">
    <div class="header">
        <div class="logo-section">
            <div class="logo">
                <img src="https://simcarabinieri.com/thumb.php?width=1800&height=1200&file=uploads/aree/images/7/logo_small.png" alt="SIM Carabinieri">
            </div>
            <div class="brand-text">
                <div class="brand-name">SIM CARABINIERI</div>
                <div class="brand-hashtag">#maipi√πsoli</div>
            </div>
        </div>
        <h1>Adesione Online - SIM Carabinieri</h1>
        <p>Procedura guidata per l'iscrizione</p>
        <div class="progress-bar">
            <div class="progress-fill" id="progress"></div>
        </div>
    </div>

    <div class="content">
        <!-- STEP 1: Domanda iniziale + Nome sindacato -->
        <div class="step active" id="step1">
            <div class="question">Sei gi√† iscritto/a a un altro sindacato?</div>
            <div class="radio-group">
                <div class="radio-option">
                    <input type="radio" id="iscritto-no" name="iscritto" value="no" onchange="toggleSindacatoField()">
                    <label for="iscritto-no">‚ùå NO</label>
                </div>
                <div class="radio-option">
                    <input type="radio" id="iscritto-si" name="iscritto" value="si" onchange="toggleSindacatoField()">
                    <label for="iscritto-si">‚úÖ S√å</label>
                </div>
            </div>
            
            <div class="form-group conditional-field" id="sindacato-field">
                <label>Nome completo del sindacato a cui sei attualmente iscritto *</label>
                <select id="sindacato-select" onchange="toggleAltroSindacato()">
                    <option value="">Seleziona dalla lista...</option>
                    <option value="NSC - Nuovo Sindacato Carabinieri">NSC - Nuovo Sindacato Carabinieri</option>
                    <option value="USIC - Unione Sindacale Italiana Carabinieri">USIC - Unione Sindacale Italiana Carabinieri</option>
                    <option value="PSC Assieme - Pianeta Sindacale Carabinieri Assieme">PSC Assieme - Pianeta Sindacale Carabinieri Assieme</option>
                    <option value="UNARMA ASC - Associazione Sindacale Carabinieri UNARMA">UNARMA ASC - Associazione Sindacale Carabinieri UNARMA</option>
                    <option value="SIUL CC - Sindacato Italiano Unitario Lavoratori Carabinieri">SIUL CC - Sindacato Italiano Unitario Lavoratori Carabinieri</option>
                    <option value="USMIA - Unione Sindacale Militare Interforze Associati">USMIA - Unione Sindacale Militare Interforze Associati</option>
                    <option value="FSC - Federazione Sindacale Carabinieri">FSC - Federazione Sindacale Carabinieri</option>
                    <option value="ASSOMIL - Associazione Sindacale Militari">ASSOMIL - Associazione Sindacale Militari</option>
                    <option value="MOSAC - Movimento Sindacale Autonomo Carabinieri">MOSAC - Movimento Sindacale Autonomo Carabinieri</option>
                    <option value="SAC - Sindacato Autonomo Carabinieri">SAC - Sindacato Autonomo Carabinieri</option>
                    <option value="SIAC - Sindacato Indipendente Carabinieri">SIAC - Sindacato Indipendente Carabinieri</option>
                    <option value="SIC - Sindacato Indipendente Carabinieri">SIC - Sindacato Indipendente Carabinieri</option>
                    <option value="SIULM CC - Sindacato Unitario Lavoratori Militari Carabinieri">SIULM CC - Sindacato Unitario Lavoratori Militari Carabinieri</option>
                    <option value="SMAC - Sindacato Militari Autonomi Carabinieri">SMAC - Sindacato Militari Autonomi Carabinieri</option>
                    <option value="UNAC - Unione Nazionale Arma Carabinieri">UNAC - Unione Nazionale Arma Carabinieri</option>
                    <option value="SCUDO Carabinieri - Sindacato SCUDO Carabinieri">SCUDO Carabinieri - Sindacato SCUDO Carabinieri</option>
                    <option value="altro">‚úèÔ∏è Altro (scrivi manualmente)</option>
                </select>
                <small>Seleziona il sindacato dalla lista</small>
            </div>
            
            <div class="form-group conditional-field" id="sindacato-altro-field" style="display: none;">
                <label>Scrivi il nome del sindacato *</label>
                <input type="text" id="sindacato-nome" placeholder="Es: Nome completo del sindacato e indirizzo">
                <small>Inserisci denominazione completa e indirizzo del sindacato</small>
            </div>
            
            <div class="buttons">
                <button class="btn-primary" onclick="nextStep()">Avanti ‚Üí</button>
            </div>
        </div>

        <!-- STEP 2: Dati anagrafici + Stato civile condizionale -->
        <div class="step" id="step2">
            <div class="question">üìã Dati Anagrafici</div>
            
            <div class="row">
                <div class="form-group">
                    <label>Nome *</label>
                    <input type="text" id="nome" required>
                </div>
                <div class="form-group">
                    <label>Cognome *</label>
                    <input type="text" id="cognome" required>
                </div>
            </div>

            <div class="form-group">
                <label>Grado *</label>
                <select id="grado" required>
                    <option value="">Seleziona...</option>
                    <option>Generale di Corpo d'Armata</option>
                    <option>Generale di Divisione</option>
                    <option>Generale di Brigata</option>
                    <option>Colonnello</option>
                    <option>Tenente Colonnello</option>
                    <option>Maggiore</option>
                    <option>Capitano</option>
                    <option>Tenente</option>
                    <option>Sottotenente</option>
                    <option>Luogotenente Carica Speciale</option>
                    <option>Luogotenente</option>
                    <option>Maresciallo Maggiore</option>
                    <option>Maresciallo Capo</option>
                    <option>Maresciallo Ordinario</option>
                    <option>Maresciallo</option>
                    <option>Brigadiere Capo Qualifica Speciale</option>
                    <option>Brigadiere Capo</option>
                    <option>Brigadiere</option>
                    <option>Vice Brigadiere</option>
                    <option>Appuntato Scelto Qualifica Speciale</option>
                    <option>Appuntato Scelto</option>
                    <option>Appuntato</option>
                    <option>Carabiniere Scelto</option>
                    <option>Carabiniere</option>
                </select>
            </div>

            <div class="row">
                <div class="form-group">
                    <label>Nato/a a *</label>
                    <input type="text" id="nato-a" required>
                </div>
                <div class="form-group">
                    <label>Provincia (sigla) *</label>
                    <select id="provincia-nascita" required>
                        <option value="">Seleziona...</option>
                        <option value="AG">Agrigento</option>
                        <option value="AL">Alessandria</option>
                        <option value="AN">Ancona</option>
                        <option value="AO">Aosta</option>
                        <option value="AP">Ascoli Piceno</option>
                        <option value="AQ">L'Aquila</option>
                        <option value="AR">Arezzo</option>
                        <option value="AT">Asti</option>
                        <option value="AV">Avellino</option>
                        <option value="BA">Bari</option>
                        <option value="BG">Bergamo</option>
                        <option value="BI">Biella</option>
                        <option value="BL">Belluno</option>
                        <option value="BN">Benevento</option>
                        <option value="BO">Bologna</option>
                        <option value="BR">Brindisi</option>
                        <option value="BS">Brescia</option>
                        <option value="BT">Barletta-Andria-Trani</option>
                        <option value="BZ">Bolzano</option>
                        <option value="CA">Cagliari</option>
                        <option value="CB">Campobasso</option>
                        <option value="CE">Caserta</option>
                        <option value="CH">Chieti</option>
                        <option value="CL">Caltanissetta</option>
                        <option value="CN">Cuneo</option>
                        <option value="CO">Como</option>
                        <option value="CR">Cremona</option>
                        <option value="CS">Cosenza</option>
                        <option value="CT">Catania</option>
                        <option value="CZ">Catanzaro</option>
                        <option value="EN">Enna</option>
                        <option value="FC">Forl√¨-Cesena</option>
                        <option value="FE">Ferrara</option>
                        <option value="FG">Foggia</option>
                        <option value="FI">Firenze</option>
                        <option value="FM">Fermo</option>
                        <option value="FR">Frosinone</option>
                        <option value="GE">Genova</option>
                        <option value="GO">Gorizia</option>
                        <option value="GR">Grosseto</option>
                        <option value="IM">Imperia</option>
                        <option value="IS">Isernia</option>
                        <option value="KR">Crotone</option>
                        <option value="LC">Lecco</option>
                        <option value="LE">Lecce</option>
                        <option value="LI">Livorno</option>
                        <option value="LO">Lodi</option>
                        <option value="LT">Latina</option>
                        <option value="LU">Lucca</option>
                        <option value="MB">Monza e Brianza</option>
                        <option value="MC">Macerata</option>
                        <option value="ME">Messina</option>
                        <option value="MI">Milano</option>
                        <option value="MN">Mantova</option>
                        <option value="MO">Modena</option>
                        <option value="MS">Massa-Carrara</option>
                        <option value="MT">Matera</option>
                        <option value="NA">Napoli</option>
                        <option value="NO">Novara</option>
                        <option value="NU">Nuoro</option>
                        <option value="OR">Oristano</option>
                        <option value="PA">Palermo</option>
                        <option value="PC">Piacenza</option>
                        <option value="PD">Padova</option>
                        <option value="PE">Pescara</option>
                        <option value="PG">Perugia</option>
                        <option value="PI">Pisa</option>
                        <option value="PN">Pordenone</option>
                        <option value="PO">Prato</option>
                        <option value="PR">Parma</option>
                        <option value="PT">Pistoia</option>
                        <option value="PU">Pesaro e Urbino</option>
                        <option value="PV">Pavia</option>
                        <option value="PZ">Potenza</option>
                        <option value="RA">Ravenna</option>
                        <option value="RC">Reggio Calabria</option>
                        <option value="RE">Reggio Emilia</option>
                        <option value="RG">Ragusa</option>
                        <option value="RI">Rieti</option>
                        <option value="RM">Roma</option>
                        <option value="RN">Rimini</option>
                        <option value="RO">Rovigo</option>
                        <option value="SA">Salerno</option>
                        <option value="SI">Siena</option>
                        <option value="SO">Sondrio</option>
                        <option value="SP">La Spezia</option>
                        <option value="SR">Siracusa</option>
                        <option value="SS">Sassari</option>
                        <option value="SU">Sud Sardegna</option>
                        <option value="SV">Savona</option>
                        <option value="TA">Taranto</option>
                        <option value="TE">Teramo</option>
                        <option value="TN">Trento</option>
                        <option value="TO">Torino</option>
                        <option value="TP">Trapani</option>
                        <option value="TR">Terni</option>
                        <option value="TS">Trieste</option>
                        <option value="TV">Treviso</option>
                        <option value="UD">Udine</option>
                        <option value="VA">Varese</option>
                        <option value="VB">Verbano-Cusio-Ossola</option>
                        <option value="VC">Vercelli</option>
                        <option value="VE">Venezia</option>
                        <option value="VI">Vicenza</option>
                        <option value="VR">Verona</option>
                        <option value="VT">Viterbo</option>
                        <option value="VV">Vibo Valentia</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label>Data di nascita *</label>
                <input type="date" id="data-nascita" required>
            </div>

            <div class="row">
                <div class="form-group">
                    <label>C.I.P. *</label>
                    <input type="text" id="cip" maxlength="8" placeholder="Es: 352412YH" style="text-transform: uppercase;" required>
                    <small>Formato: 6 numeri + 2 lettere (es: 352412YH)</small>
                </div>
                <div class="form-group">
                    <label>Codice Fiscale *</label>
                    <input type="text" id="codice-fiscale" maxlength="16" style="text-transform: uppercase;" required>
                </div>
            </div>

            <!-- Campo condizionale: Stato civile (solo se iscritto=si) -->
            <div class="form-group conditional-field" id="stato-civile-field">
                <label>Stato civile *</label>
                <select id="stato-civile">
                    <option value="">Seleziona...</option>
                    <option>Celibe/Nubile</option>
                    <option>Coniugato/a</option>
                    <option>Vedovo/a</option>
                    <option>Divorziato/a</option>
                </select>
            </div>

            <!-- Campi condizionali: Dati residenza (solo se iscritto=si) -->
            <div id="residenza-fields" class="conditional-field">
                <div class="form-group">
                    <label>Citt√† di residenza *</label>
                    <input type="text" id="residenza-citta">
                </div>

                <div class="row">
                    <div class="form-group">
                        <label>Provincia residenza *</label>
                        <select id="residenza-prov">
                            <option value="">Seleziona...</option>
                            <option value="AG">Agrigento</option>
                            <option value="AL">Alessandria</option>
                            <option value="AN">Ancona</option>
                            <option value="AO">Aosta</option>
                            <option value="AP">Ascoli Piceno</option>
                            <option value="AQ">L'Aquila</option>
                            <option value="AR">Arezzo</option>
                            <option value="AT">Asti</option>
                            <option value="AV">Avellino</option>
                            <option value="BA">Bari</option>
                            <option value="BG">Bergamo</option>
                            <option value="BI">Biella</option>
                            <option value="BL">Belluno</option>
                            <option value="BN">Benevento</option>
                            <option value="BO">Bologna</option>
                            <option value="BR">Brindisi</option>
                            <option value="BS">Brescia</option>
                            <option value="BT">Barletta-Andria-Trani</option>
                            <option value="BZ">Bolzano</option>
                            <option value="CA">Cagliari</option>
                            <option value="CB">Campobasso</option>
                            <option value="CE">Caserta</option>
                            <option value="CH">Chieti</option>
                            <option value="CL">Caltanissetta</option>
                            <option value="CN">Cuneo</option>
                            <option value="CO">Como</option>
                            <option value="CR">Cremona</option>
                            <option value="CS">Cosenza</option>
                            <option value="CT">Catania</option>
                            <option value="CZ">Catanzaro</option>
                            <option value="EN">Enna</option>
                            <option value="FC">Forl√¨-Cesena</option>
                            <option value="FE">Ferrara</option>
                            <option value="FG">Foggia</option>
                            <option value="FI">Firenze</option>
                            <option value="FM">Fermo</option>
                            <option value="FR">Frosinone</option>
                            <option value="GE">Genova</option>
                            <option value="GO">Gorizia</option>
                            <option value="GR">Grosseto</option>
                            <option value="IM">Imperia</option>
                            <option value="IS">Isernia</option>
                            <option value="KR">Crotone</option>
                            <option value="LC">Lecco</option>
                            <option value="LE">Lecce</option>
                            <option value="LI">Livorno</option>
                            <option value="LO">Lodi</option>
                            <option value="LT">Latina</option>
                            <option value="LU">Lucca</option>
                            <option value="MB">Monza e Brianza</option>
                            <option value="MC">Macerata</option>
                            <option value="ME">Messina</option>
                            <option value="MI">Milano</option>
                            <option value="MN">Mantova</option>
                            <option value="MO">Modena</option>
                            <option value="MS">Massa-Carrara</option>
                            <option value="MT">Matera</option>
                            <option value="NA">Napoli</option>
                            <option value="NO">Novara</option>
                            <option value="NU">Nuoro</option>
                            <option value="OR">Oristano</option>
                            <option value="PA">Palermo</option>
                            <option value="PC">Piacenza</option>
                            <option value="PD">Padova</option>
                            <option value="PE">Pescara</option>
                            <option value="PG">Perugia</option>
                            <option value="PI">Pisa</option>
                            <option value="PN">Pordenone</option>
                            <option value="PO">Prato</option>
                            <option value="PR">Parma</option>
                            <option value="PT">Pistoia</option>
                            <option value="PU">Pesaro e Urbino</option>
                            <option value="PV">Pavia</option>
                            <option value="PZ">Potenza</option>
                            <option value="RA">Ravenna</option>
                            <option value="RC">Reggio Calabria</option>
                            <option value="RE">Reggio Emilia</option>
                            <option value="RG">Ragusa</option>
                            <option value="RI">Rieti</option>
                            <option value="RM">Roma</option>
                            <option value="RN">Rimini</option>
                            <option value="RO">Rovigo</option>
                            <option value="SA">Salerno</option>
                            <option value="SI">Siena</option>
                            <option value="SO">Sondrio</option>
                            <option value="SP">La Spezia</option>
                            <option value="SR">Siracusa</option>
                            <option value="SS">Sassari</option>
                            <option value="SU">Sud Sardegna</option>
                            <option value="SV">Savona</option>
                            <option value="TA">Taranto</option>
                            <option value="TE">Teramo</option>
                            <option value="TN">Trento</option>
                            <option value="TO">Torino</option>
                            <option value="TP">Trapani</option>
                            <option value="TR">Terni</option>
                            <option value="TS">Trieste</option>
                            <option value="TV">Treviso</option>
                            <option value="UD">Udine</option>
                            <option value="VA">Varese</option>
                            <option value="VB">Verbano-Cusio-Ossola</option>
                            <option value="VC">Vercelli</option>
                            <option value="VE">Venezia</option>
                            <option value="VI">Vicenza</option>
                            <option value="VR">Verona</option>
                            <option value="VT">Viterbo</option>
                            <option value="VV">Vibo Valentia</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Indirizzo completo *</label>
                        <input type="text" id="residenza-indirizzo" placeholder="Via e numero civico">
                    </div>
                </div>
            </div>

            <div class="buttons">
                <button class="btn-secondary" onclick="prevStep()">‚Üê Indietro</button>
                <button class="btn-primary" onclick="nextStep()">Avanti ‚Üí</button>
            </div>
        </div>

        <!-- STEP 3: Dati di servizio -->
        <div class="step" id="step3">
            <div class="question">üè¢ Dati di Servizio</div>

            <div class="form-group">
                <label>Reparto di appartenenza *</label>
                <input type="text" id="reparto" required>
            </div>

            <div class="form-group">
                <label>Regione *</label>
                <select id="regione" required>
                    <option value="">Seleziona...</option>
                    <option>Abruzzo</option>
                    <option>Basilicata</option>
                    <option>Calabria</option>
                    <option>Campania</option>
                    <option>Emilia-Romagna</option>
                    <option>Friuli Venezia Giulia</option>
                    <option>Lazio</option>
                    <option>Liguria</option>
                    <option>Lombardia</option>
                    <option>Marche</option>
                    <option>Molise</option>
                    <option>Piemonte</option>
                    <option>Puglia</option>
                    <option>Sardegna</option>
                    <option>Sicilia</option>
                    <option>Toscana</option>
                    <option>Trentino-Alto Adige</option>
                    <option>Umbria</option>
                    <option>Valle d'Aosta</option>
                    <option>Veneto</option>
                </select>
            </div>

            <div class="row">
                <div class="form-group">
                    <label>Citt√† *</label>
                    <input type="text" id="citta" placeholder="Es: Roma" required>
                </div>
                <div class="form-group">
                    <label>Provincia *</label>
                    <select id="provincia" required>
                        <option value="">Seleziona provincia</option>
                        <option value="AG">Agrigento</option>
                        <option value="AL">Alessandria</option>
                        <option value="AN">Ancona</option>
                        <option value="AO">Aosta</option>
                        <option value="AP">Ascoli Piceno</option>
                        <option value="AQ">L'Aquila</option>
                        <option value="AR">Arezzo</option>
                        <option value="AT">Asti</option>
                        <option value="AV">Avellino</option>
                        <option value="BA">Bari</option>
                        <option value="BG">Bergamo</option>
                        <option value="BI">Biella</option>
                        <option value="BL">Belluno</option>
                        <option value="BN">Benevento</option>
                        <option value="BO">Bologna</option>
                        <option value="BR">Brindisi</option>
                        <option value="BS">Brescia</option>
                        <option value="BT">Barletta-Andria-Trani</option>
                        <option value="BZ">Bolzano</option>
                        <option value="CA">Cagliari</option>
                        <option value="CB">Campobasso</option>
                        <option value="CE">Caserta</option>
                        <option value="CH">Chieti</option>
                        <option value="CL">Caltanissetta</option>
                        <option value="CN">Cuneo</option>
                        <option value="CO">Como</option>
                        <option value="CR">Cremona</option>
                        <option value="CS">Cosenza</option>
                        <option value="CT">Catania</option>
                        <option value="CZ">Catanzaro</option>
                        <option value="EN">Enna</option>
                        <option value="FC">Forl√¨-Cesena</option>
                        <option value="FE">Ferrara</option>
                        <option value="FG">Foggia</option>
                        <option value="FI">Firenze</option>
                        <option value="FM">Fermo</option>
                        <option value="FR">Frosinone</option>
                        <option value="GE">Genova</option>
                        <option value="GO">Gorizia</option>
                        <option value="GR">Grosseto</option>
                        <option value="IM">Imperia</option>
                        <option value="IS">Isernia</option>
                        <option value="KR">Crotone</option>
                        <option value="LC">Lecco</option>
                        <option value="LE">Lecce</option>
                        <option value="LI">Livorno</option>
                        <option value="LO">Lodi</option>
                        <option value="LT">Latina</option>
                        <option value="LU">Lucca</option>
                        <option value="MB">Monza e Brianza</option>
                        <option value="MC">Macerata</option>
                        <option value="ME">Messina</option>
                        <option value="MI">Milano</option>
                        <option value="MN">Mantova</option>
                        <option value="MO">Modena</option>
                        <option value="MS">Massa-Carrara</option>
                        <option value="MT">Matera</option>
                        <option value="NA">Napoli</option>
                        <option value="NO">Novara</option>
                        <option value="NU">Nuoro</option>
                        <option value="OR">Oristano</option>
                        <option value="PA">Palermo</option>
                        <option value="PC">Piacenza</option>
                        <option value="PD">Padova</option>
                        <option value="PE">Pescara</option>
                        <option value="PG">Perugia</option>
                        <option value="PI">Pisa</option>
                        <option value="PN">Pordenone</option>
                        <option value="PO">Prato</option>
                        <option value="PR">Parma</option>
                        <option value="PT">Pistoia</option>
                        <option value="PU">Pesaro e Urbino</option>
                        <option value="PV">Pavia</option>
                        <option value="PZ">Potenza</option>
                        <option value="RA">Ravenna</option>
                        <option value="RC">Reggio Calabria</option>
                        <option value="RE">Reggio Emilia</option>
                        <option value="RG">Ragusa</option>
                        <option value="RI">Rieti</option>
                        <option value="RM">Roma</option>
                        <option value="RN">Rimini</option>
                        <option value="RO">Rovigo</option>
                        <option value="SA">Salerno</option>
                        <option value="SI">Siena</option>
                        <option value="SO">Sondrio</option>
                        <option value="SP">La Spezia</option>
                        <option value="SR">Siracusa</option>
                        <option value="SS">Sassari</option>
                        <option value="SU">Sud Sardegna</option>
                        <option value="SV">Savona</option>
                        <option value="TA">Taranto</option>
                        <option value="TE">Teramo</option>
                        <option value="TN">Trento</option>
                        <option value="TO">Torino</option>
                        <option value="TP">Trapani</option>
                        <option value="TR">Terni</option>
                        <option value="TS">Trieste</option>
                        <option value="TV">Treviso</option>
                        <option value="UD">Udine</option>
                        <option value="VA">Varese</option>
                        <option value="VB">Verbano-Cusio-Ossola</option>
                        <option value="VC">Vercelli</option>
                        <option value="VE">Venezia</option>
                        <option value="VI">Vicenza</option>
                        <option value="VR">Verona</option>
                        <option value="VT">Viterbo</option>
                        <option value="VV">Vibo Valentia</option>
                    </select>
                </div>
            </div>
            
            <div class="row">
                <div class="form-group">
                    <label>CAP *</label>
                    <input type="text" id="cap" maxlength="5" required>
                </div>
            </div>

            <div class="row">
                <div class="form-group">
                    <label>Cellulare *</label>
                    <input type="tel" id="cellulare" required>
                </div>
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" id="email" required>
                </div>
            </div>

            <div class="form-group">
                <label>Sei in ausiliaria?</label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="ausiliaria-no" name="ausiliaria" value="no" checked>
                        <label for="ausiliaria-no">NO</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="ausiliaria-si" name="ausiliaria" value="si">
                        <label for="ausiliaria-si">S√å</label>
                    </div>
                </div>
            </div>

            <div class="buttons">
                <button class="btn-secondary" onclick="prevStep()">‚Üê Indietro</button>
                <button class="btn-primary" onclick="nextStep()">Avanti ‚Üí</button>
            </div>
        </div>

        <!-- STEP 4: Firma e documenti -->
        <div class="step" id="step4">
            <div class="question">‚úèÔ∏è Firma e Documenti</div>

            <div class="form-group">
                <label>Luogo *</label>
                <input type="text" id="luogo-firma" placeholder="Es: Roma" required>
            </div>

            <div class="signature-area">
                <p style="margin-bottom: 15px;"><strong>Firma qui sotto con il mouse o con il dito</strong></p>
                <small>Questa firma verr√† utilizzata per tutti i documenti</small>
                <div class="signature-wrapper">
                    <canvas id="signature-canvas" width="600" height="200"></canvas>
                </div>
                <button class="btn-secondary" style="margin-top: 10px;" type="button" onclick="clearSignature()">üóëÔ∏è Cancella firma</button>
            </div>

            <!-- FRONTE DOCUMENTO -->
            <div style="background: #f0f9ff; border: 2px solid #0ea5e9; border-radius: 12px; padding: 20px; margin: 20px 0;">
                <p style="font-weight: 600; margin-bottom: 15px;">üì∑ Documento d'identit√† FRONTE</p>
                
                <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px;">
                    <button type="button" class="btn-primary" onclick="openCamera('fronte')" style="flex: 1; min-width: 140px;">
                        üì∏ Scatta Foto
                    </button>
                    <button type="button" class="btn-secondary" onclick="document.getElementById('doc-fronte-file').click()" style="flex: 1; min-width: 140px;">
                        üìÅ Carica da Galleria
                    </button>
                </div>
                
                <input type="file" id="doc-fronte-file" accept="image/*" style="display: none;" onchange="handleFileUpload(this, 'fronte')">
                <input type="file" id="doc-fronte-camera" accept="image/*" capture="environment" style="display: none;" onchange="handleFileUpload(this, 'fronte')">
                
                <div id="preview-fronte" style="display:none; margin-top: 15px;">
                    <img id="preview-fronte-img" style="max-width: 100%; border-radius: 8px; border: 2px solid #0ea5e9;">
                    <div style="margin-top: 10px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button type="button" class="btn-secondary" onclick="autoCropDocument('fronte')" style="flex: 1;">
                            ‚úÇÔ∏è Auto-Ritaglia
                        </button>
                        <button type="button" class="btn-secondary" onclick="removeDocument('fronte')" style="background: #ef4444;">
                            üóëÔ∏è Rimuovi
                        </button>
                    </div>
                </div>
            </div>

            <!-- RETRO DOCUMENTO -->
            <div style="background: #f0f9ff; border: 2px solid #0ea5e9; border-radius: 12px; padding: 20px; margin: 20px 0;">
                <p style="font-weight: 600; margin-bottom: 15px;">üì∑ Documento d'identit√† RETRO</p>
                
                <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px;">
                    <button type="button" class="btn-primary" onclick="openCamera('retro')" style="flex: 1; min-width: 140px;">
                        üì∏ Scatta Foto
                    </button>
                    <button type="button" class="btn-secondary" onclick="document.getElementById('doc-retro-file').click()" style="flex: 1; min-width: 140px;">
                        üìÅ Carica da Galleria
                    </button>
                </div>
                
                <input type="file" id="doc-retro-file" accept="image/*" style="display: none;" onchange="handleFileUpload(this, 'retro')">
                <input type="file" id="doc-retro-camera" accept="image/*" capture="environment" style="display: none;" onchange="handleFileUpload(this, 'retro')">
                
                <div id="preview-retro" style="display:none; margin-top: 15px;">
                    <img id="preview-retro-img" style="max-width: 100%; border-radius: 8px; border: 2px solid #0ea5e9;">
                    <div style="margin-top: 10px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button type="button" class="btn-secondary" onclick="autoCropDocument('retro')" style="flex: 1;">
                            ‚úÇÔ∏è Auto-Ritaglia
                        </button>
                        <button type="button" class="btn-secondary" onclick="removeDocument('retro')" style="background: #ef4444;">
                            üóëÔ∏è Rimuovi
                        </button>
                    </div>
                </div>
            </div>

            <div class="buttons">
                <button class="btn-secondary" onclick="prevStep()">‚Üê Indietro</button>
                <button class="btn-primary" onclick="nextStep()">Avanti ‚Üí</button>
            </div>
        </div>

        <!-- STEP 5: Riepilogo e conferma -->
        <div class="step" id="step5">
            <div class="question">‚úÖ Riepilogo</div>

            <div class="summary" id="summary-content"></div>

            <div class="alert" style="background: #dbeafe; border-color: #3b82f6; color: #1e40af;">
                üìÑ Verranno generati <strong id="pdf-count">1</strong> documento PDF<br>
                <small style="color: #1e40af;">Ogni PDF conterr√†: Pagina 1 (Modulo) + Pagina 2 (Documenti)</small>
            </div>

            <div class="buttons">
                <button class="btn-secondary" onclick="prevStep()">‚Üê Modifica</button>
                <button class="btn-success" onclick="generateDocuments()">üìÑ Genera Documenti PDF</button>
            </div>
        </div>

        <!-- STEP 6: Successo -->
        <div class="step" id="step6">
            <div class="success-message">
                <div class="checkmark">‚úì</div>
                <h2>Documenti Generati!</h2>
                <p>I tuoi documenti sono stati generati con successo.</p>
                
                <div id="download-list" style="margin: 20px 0; text-align: left; display: inline-block; background: #f8fafc; padding: 20px; border-radius: 8px; border: 2px solid #e5e7eb;"></div>
                
                <!-- SEZIONE DOWNLOAD MANUALE -->
                <div class="manual-download-section">
                    <h3 style="color: #065f46; margin-bottom: 15px; font-size: 18px;">üì• Download Manuale</h3>
                    <p style="color: #047857; margin-bottom: 15px; font-size: 14px;">
                        Se i file non si sono scaricati automaticamente, usa i pulsanti qui sotto:
                    </p>
                    <div id="manual-download-buttons"></div>
                </div>
                
                <!-- SEZIONE UNICA PER EMAIL, WHATSAPP E TELEGRAM -->
                <div style="background: linear-gradient(135deg, #e0f2fe 0%, #e0f7e0 100%); border: 3px solid #0891b2; border-radius: 12px; padding: 25px; margin: 30px 0; max-width: 600px; margin-left: auto; margin-right: auto;">
                    <p style="color: #065f46; font-weight: 700; margin-bottom: 20px; font-size: 18px; text-align: center;">
                        üìß Invia i documenti
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 20px;">
                        <button id="email-button" class="btn-primary" style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); padding: 16px 12px; font-size: 15px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; border: none; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                            <span style="font-size: 24px;">üìß</span>
                            <span>Email</span>
                        </button>
                        <button id="whatsapp-button" class="btn-primary" style="background: linear-gradient(135deg, #25D366 0%, #128C7E 100%); padding: 16px 12px; font-size: 15px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; border: none; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                            <img id="whatsapp-icon" src="" alt="WhatsApp" style="width: 24px; height: 24px;">
                            <span>WhatsApp</span>
                        </button>
                        <button id="telegram-button" class="btn-primary" style="background: linear-gradient(135deg, #0088cc 0%, #005f99 100%); padding: 16px 12px; font-size: 15px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; border: none; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                            <img id="telegram-icon" src="" alt="Telegram" style="width: 24px; height: 24px;">
                            <span>Telegram</span>
                        </button>
                    </div>
                    <p style="color: #065f46; font-size: 13px; line-height: 1.6; text-align: center;">
                        <strong>Come procedere:</strong><br>
                        1Ô∏è‚É£ Clicca sul pulsante della piattaforma che preferisci<br>
                        2Ô∏è‚É£ Si aprir√† automaticamente l'app con messaggio precompilato<br>
                        3Ô∏è‚É£ Allega i PDF scaricati<br>
                        4Ô∏è‚É£ Invia al destinatario
                    </p>
                </div>
                
                <button class="btn-secondary" style="margin-top: 20px;" onclick="location.reload()">üîÑ Nuova Adesione</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script async src="https://docs.opencv.org/4.5.2/opencv.js" onload="console.log('OpenCV.js caricato!')"></script>
<script>
let currentStep = 1;
let totalSteps = 6;
let formData = {};
let signaturePad;
let signatureImage = null;
let documentoFronteImage = null;
let documentoRetroImage = null;
let logoImage = null;

// ICONE BASE64 - Inserisci qui le tue icone
const WHATSAPP_ICON = null; // Sostituisci con: 'data:image/png;base64,TUA_STRINGA_BASE64_VERDE'
const TELEGRAM_ICON = null; // Sostituisci con: 'data:image/png;base64,TUA_STRINGA_BASE64_BLU'

// Variabili per salvare i blob dei PDF
let pdfBlobDelega = null;
let pdfBlobRevoca = null;

// LOGO WEBP BASE64 - Verr√† convertito in PNG al caricamento
const LOGO_WEBP_BASE64 = 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAMCAgICAgMCAgIDAwMDBAYEBAQEBAgGBgUGCQgKCgkICQkKDA8MCgsOCwkJDRENDg8QEBEQCgwSExIQEw8QEBD/2wBDAQMDAwQDBAgEBAgQCwkLEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBD/wAARCABSAJIDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD9U6KKKACiiuR+JfxT8GfCbw+fEHjDUjEJCY7OzgXzLu/mxkQwRZy7HueFUZZ2VQWClJRV5PQmc404uU3ZLqdaSAMk4Arwvx/+2F8LfConsvCMkvjXUogwP9lSILCJguf3t837rb2byvNdcHKcV8xfGb47eLvi59q/4Sa5GieEYV8xdBhn3QmNefMvZBj7S3fy/wDUrhQFkZRIfNfCXjfTGltdZvvh1NrwuZlh8P6JqUUoS+lGCjtp8KNPeE/w258qNFAdzJuxD4NTOVVqeyw1rfzO9vklq32/y1PjMRxWsTX+r5fa17Ock2vSMV70n2S/LU+rfhz48/aR+JOqQ/FTxB460jwF8NLO4hvblrqwt1tL2yDAmO3e4XzmR0wpvHkiQ7w0UbA4X2jQf2ivgz4p0+61Lw744t9Ritr+XTVS2tp3mu7iIRtItrCE8y6VRKhLwq6gHOcA4+etH/Zu+PP7Rut2vjr9p7xQ3h7SYmEth4W03YZ4kzkBsGSG1zkghTNMR8rzYARfWPAvww8Da8ItM8IeELXTfh7pslxZ3Di5Ek3iSe2kEKJKRueSxjZJxskcCQrGNnlcSevh4zjH3r/Pd/LZen5H0+ChWhC1Rt+cvifyWkV2S+dmd58OPi74a+J9zqtroFnqETaSY/NknWJopA5cLskhkdN37ttyMQ65G5RkV3FNjjjijWKJFREAVVUYCgdAB2FOroO4KKKKACsLxZ438L+B4tMn8U6oLFNY1O30eyJhkk827nJEcfyKdoOCSzYVQCWIAzW4eQQDj3r5E8b2GvJrN54C+OHxXl11LO2jtrS+lksbC1mk1BJoVxHFDG0V6qRyYTfIAsyup/eFU8LiLPI8P4J42dNzSaWlt3or63+5M7MDhHjaqpKSXqfXlFeR/AC4+I3iHTrzxp4w8e3Wq6Xfs9pp2lXNraCe0eCaSOaSeW3ghHml1ZDEAyp5f33LHb1njT4oeH/AviTwt4Z1i2vXn8VXT2sE0MatFbYaONXmJYEK01xbQjaGO+ZcgKCR6dDFwr4eGIa5VK1r2vrts2ru669e5zzpuM3BatdvI7CiiiuozCiiigAoorwL9ob9peP4c3EngXwCtpqHi4orXk04Mlro0bqGQyqpBkndSGSAEYUiSQqpjEuVatTw8HUqOyRz4vF0cDRdfES5Yrr/AF+R1Hxz+P3h74OWEdhFCmr+KtQiMmn6QkuzEeSv2i4cA+TAGBG7BLEFUDHIHwz4l8SeIvGviO68YeMdWbVNZvF8t7gpsjghBytvbx5IhhXsgJJOWdncs5p3t5f6pqV7rmtalc6lqmpy/aL6/u3DT3MmMAsQAAAAFVFCoigKiqoAr2r4E/s36l8R/J8UeLBPp/hkENEgyk+of7n9yP1fqf4f7w+NxeNxGc1fYYde72/V/wBfiflWZZtjuK8SsHgotU+3f+9J9vL82cR8K/hF4s+LGsLZ6Hbtb6fC4F5qcqHybcdwP78noo/HA5r658N/Dn4Lfs0+G9S8d6ve2Onm1ts6p4m1mVPO8rP3BIcCNC2AIowAzY4Zjk9Z4k8SfD/4I+BG1TUza6LoWlxiOGCCMAu38MUSDl5GPbqTkk9TX5x/HL44eIPjh4vtdd1q28rRtHuVn0jRXffDAVORK46PMw4L4+UEhcDJPfFYXII3n71V/wBfJfiz9u8MvCDFZo3Vo2SWkqslov7sF1ffVf3mrpH1f4y+L3xt8b2lteeC/hRqsPhXU0jlgsRqZ0/xDqFizgPdyKbeUWVtsJ/dgi8fK7BE4K12tv8AFvWvDmu+Hfg/p3wt07Ttcuo7iGwtBrQj0qKxs4ULFJY4GmTaJLdVR7ZFO/hvlxXP+I7r4eftfeD7XRtC+MN94djkiDzabpl2LXUlnYYaObLBniwSNqgZOGD9K8r+Cvg/xf8AB39ogeGtc+Imt+LvB2lw31kdXv4UkSzuraz+1JaSTybp1WOC+mYDzGRi75+ZDXuwxXPJcqvF7NWa+et16noYrIfqtGXtaip1oJuVOalGWjt7rcVGTf8ALe/VX6e9eJfj3qPg/wAMarf6/wCC4Brel64dDNlZ6m89q8g01dReXz/s4l2LbF+FgZy6bVVtwNedaD+2zqPiO+SLSvhTDdWQM2+4i12RXuBFHBI4tI5bSPzmK3KIgcxbpVZMqAHLfGGi6l468I+PLvWPFWj+EFn8fW948OrX0dkhRdJsRbIt26SNazhRFOSiMS6vEfkZjXl9l8HNL1bV1GvfFX4SX+gSS28muzQ+NW+3NbCTT45JZJUgTzbhxaD99mH55kHBQM3z+c1c8jilDLY+40tXy2Tvq2m+Z6W2ta3VvTgwscG6bdd6/O/+R67P+2eJdRvX0fwVpF5ocU0ostT/ALfnP2uBJLxTPsispFiTy9PnlZncIiYLOvOOkn/a38FQ6vE01mlr4dtk8nWtQurvbdaVfBZN1o1qiP5rI4to2aOQgveQbN4bdXk198BPF1hreswDxh4AtI9FtlN/Pb+JjYXCwyJfpNc3cH2KQW32iLUJHbY6lXLGOQcMKE/7MOr3uh6lb3nxA+F0/iO8sdQ1G32TSxtcWF3MJW1FZtx+zxq8dqVXyJ0As41Mx37k8+ni+KE3J0ftap8llFWaUWmm7q8W2tHZrqjeVLLnop9PPfz0+eh67Z/tb6fb6xCvi7wbLomh3U9xBDf/AGmaeVfJcrKWT7OsEnk7W8/7NcT+TtctlUd184j+OnhtPGnizXtU/Z90iLVtV0y3k1m+1TW7u8tri3e1lV7ZCljNEjiKxkjmgUIZGtiMS7AwnuPhj8XNY0XQvDemfF3wfdabqNxNcadYW/jGe3s9Xi87zbyKGKC18x4n+cNHLLdpFGzRqMEOmQP2bPFXii4Fh8NPiJ8NfEGhx/2jHrjWF5PbZur2OUOXt4/tQLxyz3MqkzJu+0yptXHmGqtXiGpGEYQaet21Tum1pyrmkrJprVXalvpdzGOCi23L0S5tvPRevqjoPBPx20HTPAR8OaR8ItX0LwjqK3C3L2Ou3817bNdxtO5t5WgCRyskonihNzFcbJEKxI5WM4JuPCeman4k0a98RXPimHS7iOztdda8vbrFmqRTwzXdwjOliFucxmdTEjyW5cKu3C+gN+zh8U7D7T4O0LxxZw+EZ72G5WSW53Shoo40hnktfsxLzxiGHhbpIXkiWYxKWaM++eEvBfhbwLosfh/wnodnplkgTckESqZmWNY/MkIGZJCkaAu2WO0ZPFRichxvEOGeEzCcqai4tOPKnzK91HldnBNQcXJc2j2dnFwxlLBVPaUEpXvvfbSzd+u97abbnDfs56Atp8PrPxfL4p1bWbvxZb2+pXCXd/NPBYsY/wDj2gSSWQx7CSrkuzM6sWPCqvqlfOHjb4lWmraJrHwQ+GPhPxN4Il0y/XSptRs0s9Oj0u2Sbc00ESTecqTRowhdYgGEoYEAHHbfC345zeNtWsfBGueB9d07xHFpcd3q0yrbTWFvLtAILwzyPGsj7/K81VLqjED5Tj6HCZxlqxP9k0qsXVgl7t9eqtq27q12nqk03ucVTC1/Z/WZRfK3v/Xroes0UUV7ZyHkf7SPxnb4SeD4rfQ2jfxV4hMlro6OoZLcKB515Ip+9HCHU7f4pHhQ7Q5Zfg6NCm9nnnuJZpHnnnuJDJNcTOxaSWVzy8jsSzMeSSa9G/al1LXpP2gvELanpOpTWkc2n6NY3f2fZb21qdP+1Iu9sB985vsbdxJjbOBHxL8CPhHc/FjxelvdwyroGmkTanOoIDDqsCt/efvjkLk+lfGZxUr43FrCxWnRd+7/AD+R+T8U1sbm2Zxy+nFqKdoru9U5emjV+iTfU7T9nD9nz/hOZYvHPjS0YeHoXzZ2jjH9oOp+83/TEEf8CIx0Bz9V+OPG/hT4X+ErvxV4ovY7DS9OjAAVRuduiRRJ/Ex6BR+gBI07m40jwvopmkEVlp2nwqioi4VEUBVRVH4KFHU4Ar4g+JkXxS/aD+Jdhe+KvD91ofgfTbnNpY3EyK4hH3pHQMSZpMBf9hTgdydcxzTL+EcJapOPtGr2bV3brbe3ZLd6d2ftvhxwHhaj5K9RQow1qTulKTX2YJ7t9FryrV3bs/Ifjl8Y/F/xk8XPqviSKWwsbTI0zSSTss4mAIY/3pGUqWfvkAYUCuL8NeG9e8Y+ILPwt4X0W/1fVL5v3dnYorTGMMA8hLEJGi5GZJGVASAWGRn2T4s+CpPiP4lh1XwNbRyXlnftomv28DRPNZRxH5LoW7SRmUeVjEYZS3yDcoyw+lfgzqHwO+DnhLWdD8A6frL+IbbQ7nxHqn9sabPbX+qR2gAZnneIRFVaVVVIyUTzDtUZavm+HsTR4jlGpiKqjUe8HJc9+tlva2qdrW28v6GzvxAwnC2UUsJlOHtV5bctnyU+mr+029Ur3d+aT11wNS+An7NGpnSW1/4ZeMfD+o6DGsDodEu50uGEe0NM0Mc9ncvjLB1ZiG+YEMARi/Enw/4n1zwb4J8P+C/CutDTdL8Wp4r1vU7zw9f3KXV2jPPFZi3UJdyxkPt+1AeWphhBZyzBfdrn4i+M/C8Oja5440DR4/D2pSrHeahptzcS/wBlRtC8i3NxvhCrAGRUeQlQnmB2wobG/wCJfFmtQ+ILXwd4N0q01DV5Lc395JeXDRW1haZZY3kKKzF5ZFZY0AG4RzNu/d7W/TqdKFFctOKS8j+bsZjsVmFT2uLqyqS2vJtu3bXp5HzH8eJZrr4Ya54j1vSrzRrfX/G+o3WnJqkLWtw6f8IvcwRNskCujmSJlUEA5A27shm8y8X3VhqPxX1Twp4aFpq2veEb67/sa1vGvNS2yteX1t5JtrcSyTOLKK6LyNG7r5duWZQx3fTnxT+NfjbwP4eubi+PhjQ7vStbNpfX06T39kloukz3/mlQYXXDQqrYJwu4jkjHmfjD9rX4hy3jTeE7fw/obwDZd6ZeWn9o3FuxtRMrvPDOkZEhy0YXJMPlSNtaTy0/P+KKWUzxcvrtblnyxVlDmfK+ZOzs9GrqXa6vrJX9LLpYpU0qMbq762V9N/0+Z5DY+P8ARI47+fULuxu7Zri00OG+i1C0YNZwXuifZLi4EkqyfPa2gZvlYhxICBjFZWoeLtbvfh1N4pT+xjbjRJtOj3RzMq3CWH2JLMXez7KpbSPOm8gyhhPODs9foHxN+0T8VbS20q40yz0BmXSJdR1HbpZaScRNqxlkj33CqmItLDBCWyZGGelU7b9qj4haN4uGmeLL/wAJxeH4rvyY86c32u/+z3NyNRVUiuHERhtLR7lFZS7eZFkYYZ4KtHCxnClWxcrwakmqb1bkp+87u6TqpyslZdVZs2jOo05RprXS1+ytpp/d08/U8i8Q3U+sFr3xDPYvpl7q9y+j6baRmeC5iOpSx/2hGseWe2YWKG7gQEDy5ZSClyS3r/wfu9L1r4yeFrn4c2+sCKxsI49VlvdUtr6UxG3uRcPJJayOiW8kn2PbHlY2mRHhhRY5CaCftV/F19O0yVG8NRS6g+mxiefRZUhBureKc/ZGFz+92iUoFONwilbcPL2v9a+CdUk17whoviCe2ggn1bT7a/nSFcIJJYldsZ5xlu5Jrt4eyrA4is5YSu5ezdNvmh70UkuVQk37qko2lo7wtF2tcxxuIrQglVha99no+911tfTs7s26KKK/RjwzyH4k/Cvxr49+JunazYavpejaJp+iPZDUUj87UllmuFe4jjidDFtK29ttkctsPmARtu3Lq/BLwN4v8A2nibTfFbaNKL/XH1G0uNN3qJ0eCFHd43XdEzSRu+wvLt37Q5VVpPi98U/FHwzm0240/wAB2+qaNdhku9Xu9WaztrGfcojjl2QTMofLYlYLGCApYM6g+O+CfG/xF+EX2zR9P8H6f4z1XxfetrT2MGrzW91Lq8oUXogQwSItrv8ALcO7RRx723lQRnzYZXg6WNlj4w/fSVnLW7Wmna3uqy6O73bv6VOlisRhHy604+mm/wDmfVlFIpJAJGCRyPSivSPNPDv2nPhH8Rfi4fCOneDLvR4tP028urm/GozyII5miEUM4VEYyBI3uV2ZUkyJ8yjLLD+y2D4N0jWfhfretanc6npV1PqarqOgvpjJYy3EscbhmRVn3NC77lLiNHijLMV3v7xXgn7TXwQ8ffEfw94tvfh74ra0vta8OW2iy6WiiGS+ghupJpYEuy+IRPFNLEflGSI90irurB0KcKjrpXla3y7IwoZfh5Yz6xopytHmfRX+dl1dkfNn7WH7RUvxR8Q/8If4P1Bh4U0WfcJ4XwNRukP+uyOsaH7nqfn/ALuOx+A/jbXvG3hGafxABLPptwLNbv8AiuV2BtzD+8MgE9+vXNfKWo6NruhaxdeF9W8M6jY63p92NPk0ZoR9qFwWCxQoikhjJuj8vYSriRCpIYGvuP4Gfsm+O/Bfh+XQvG/jyCC0urz+0rhNF3fapZJIot9uJ5FAghjZGjHlqZHXDiSNiVH5NxFw9j+LISjTgvaKSV5aci6+drK1kn0dup/TPF2L4f4XyHC5fhEpcy5oNWba+1Nv++9Oz6fCrebeMZ/BVnokfh2+8HaNca7p7eLPFt/bXulLFc38lvqCT2B+1NGXeAwyKxMLEkQpGxAV4j9Kan8ONM+HXwY8du142p63qWgX82saxNGElvJFtZdqqoJEUMYZhHCpIQEklnZ3ej4q/ZxtYtJuLb4ba1NYLLbyQyaRrFzNfWFyHR1b95IzXFu77lBkRmTGWMMjEmu3Xwl4hvPg4PAms6nbza7P4Z/si7vFZjE921r5TygkBtpclumcds19hw9lGMwWKnUzCMW4whCEk21ypNSST1jeyclrd/adkl+AY7FU61NKi3q22n3e3r1seZ658Vta0+f+xtNtNFOgaVZnTdau7uSS5FnGlrZyz3D2o2rIsQvYvMQuCIhK+f3extq3vtE+Eeu6H8O/h1YJqD6tqttLr15f3rzSWlpMjx2qhzlpJNkCxRIThYbZ2Y5C+Zl/CXSPHUvjvRtQ8QeENS0W00zw/d292tzDEqvqNy9rJcyeakjecGkjZEG0BVtt2SHStvxv4Bh8EeHfDdn8M/DksNpY+JodTvhb20moTJGltKiMI2lV5AGW2gC78RxBQoCRgL9geYc98VvB+geNG8YWPiPxVdaDa2/iCxYS2lmbue4afSfshgiiUM7SMly+3YrMGAO1gCDxPxF+F/wu8ZXP2/w14nvvA1ra2ccMeg2nhLJnaW6lh821RQBLumvAr+XuEbOhk2bsV2fiLwV8QfGXhvxHq15oFwtzfa47wQG3hgu2sZNENg08cRuCokSW4mbY0qF442UEM6k8fqHgzxT4r8ToNH+Fk3h+HUNOuraz1PQ9HGjPZXbQLa+b9pnzJGUhlnl3PaKrNDZpH5rQ7q4sTl2Fxakq9NS5rXut7bfdc1p16tK3JK1v1Mey+F/gIalf6xcfEnxFeWF7os0NyNO8JXZigW6sLwqQGMrRusepzTNEiDBK7lXDVe0n4TfDXw3b+K9Nvfi7ruo301xPrsd9ZaQ4s/tM/l3c0aqm6K+MkFxbr5O5j9n4TBDuJLfwd44TXNfmT4d6yrW2sza/ZzXFs7/2dcPDZZaHyykd8V1GN7rYNoaCIqo3ERtyWjWWuXuh3Xhbw/o/jGPXPB8Ohx3mjtvuDZXDvJcySrC0KOwktbi708S+aSEity0MalGrklkWVyiqc6MWuiav0t18kvkvI1WMxCfMpv8Ap/5sivPhF8LvD9voPho/Efxjb67Z3FrPbQv4Pu5lEdstvptssMX+rj2tMkMm1yWa6HmDhCn0jH8avhf8PfDmiaKLzXby0tdKiSKWDRrqdkjhWWNlm2R/u5lNpOHjYB0aJwygjFeMS+DfE2n6/Y69D8NtdeyGrSXJbR9DNpAsb6vo92/m2rP5z3JjsZ2M+wJtSOIM7AE5uo/Dz4iaJ4csotZ8IeMda8S6lYRzarewW4uEuZTpckSOwRisVwJZmhmwcSNF5+B5rV2YXL8LgW3h4KN7J2622+4yqV6layqO9v1PpBPjj4PfVW0X+zvEYvIoxLLENFuGMSF9gLbVODv+UL94ngA1q+A/in4M+JTXw8I3t3cDT8ea09hPag/vp4DtEyKTtmtbiNhjKtEwIHGfmR/hvreq+K/E8bfCabVNN8Sb5jbwaXd6MksYubieRJpZSAtw8UhRSG2GWUklRyO8+Dei/GEaH41uIozpnim5idbLU9c0iSC0upm1nV7pT5AYOqG3urcH72wv/wAtCjA9bdkZHpvxesYPGWir8LdP8aaZoeu+INl1bR3cZna5tLa4he5UQLJG0qFCI3G4ArIQeCaxtF+Bt/4X8e6B4u0P4g6pc2lh9qXU7XVUW4mu1mgKsI5k2CFGmWCVothjzCnlrEAQ3iWqeI/EE13efGDxJrz23ifwn58JaLTIpRarp/2uK6iSJZSs4P2q4VnDryI8hGTA+mfhknxIHhkTfFK40x9YuJ3mSGxh2C1tyF2RSkMyvKPmLMnyZO1dwXe3z2S8R4bPK9ejQhJOlLld012/G91byv1R6WIoV8DSinL3Zq9k9/6Vv0Osooor6I80KKKKAPPvE3wM+H/iz4p+HfjBrFjO+v8AhuEw24EgNvOBvMLTRsDuaFppXjIKkM+47iqbfQaKKSio3aW5pOrUqKMZybUVZXeyu3Zdldt27thRRRTMwooooAKKKKAOK+LOneOL3wt9q8B+PIfCt5ps3225nuIoDDc2yRvvhkkmilEC8q/miNypjHysCQfmXR9bvn1DTda8H+OtRs/HGrvFBeyX13Ym5gfVWhkRdRj+zyoih4oIoxHEpB2RqVVya+v/ABBoOleKdB1LwxrtqbnTdXs5rC8hEjxmWCVCki7kIZcqxGVIIzwQa5i5+CvwuutI0HRJPB9qlt4YuUvNKMUkkU1vOsqyl/ORhI5eSNHk3MfNZQ0m8818znmQ1s2xWHxFKvKmqTu0nJc3S2jXL7rkuZa69kd+ExkMNTnCUFLmVumn+ettPI0tN1S28F6DpOj+PfiBY3urrarHPqN8YLF7+VQA8ohUhVyedq8DIFcZ8K/j94f8d2mq3HiG/wBF0GSK+8zSoZtQVJLzSJ0D2V4Vk2lTIpcFRkBo3GTiqP7TnhnwxN4Pj8aXOitP4j065tNO0q6t7Q3Ey/arqGJo2hEcn2iI7txiKEtt+QpIVceZW/he28UfE/wn4O+KXw11XTdJ1hL1Y7G7tYZYr8JD50AmuId4SJUiuBJbF1JdoQweMsGWY5pmWFzShhMPh+ejL4p3fu32v7rts7au+l+XcdDD0KmHnUnO0lsrb9+v9eZ618VPjXf+DdSvvBGjeDdXfX7zTZJdC1C5NrFpt1dGN9qh5J1eTy2CmRFUuFOQpBBrl/hT8U7/AMFRaL8I9a0XxX4o1Br57ey1UXsF/PLYPMCLq68yYXCxwCURySMpGEXBZnVD3nxm8BeLviFaeHdL8MatpmnQWOsLqF/PeI8pVEglWIxxLhZWWV45Arsq5jUknG1sv4c/Cbxh8PviTqOsN4otda8OahokVk9xeRKmrSXEM7PAsvlRrC6IJ7vDqEJ85FKEp5jGIo5287p1KU19UStJW1u9e+tuVK+65nZPVohLCfVJRkn7S+nb+tfwHL+zJ8Kn0K/0q+sL6+1C/kuJTr11dGTVYHmkdz5Nxj92oMjZRQEcM3mLIZJC/pGg6RD4f0PTtBtrm6uYtNtIbOOa6l8yaRY0CBpH/icgZJ7kk1for6KnQpUXenFL0SXd/m2/m+5wynKXxO4UUUVqSFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFAH/2Q==';

// Funzione per convertire WEBP in PNG e caricare il logo
function loadLogo() {
    return new Promise((resolve) => {
        console.log('üîÑ Caricamento e conversione logo...');
        
        const img = new Image();
        
        img.onload = function() {
            try {
                // Creiamo un canvas per convertire WEBP -> PNG
                const canvas = document.createElement('canvas');
                canvas.width = img.width;
                canvas.height = img.height;
                
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0);
                
                // Convertiamo in PNG Base64
                logoImage = canvas.toDataURL('image/png');
                
                console.log('‚úÖ Logo convertito in PNG e pronto per il PDF!');
                console.log('üìê Dimensioni logo:', img.width, 'x', img.height);
                resolve();
            } catch (error) {
                console.error('‚ùå Errore conversione logo:', error);
                logoImage = null;
                resolve(); // Continua senza logo
            }
        };
        
        img.onerror = function(error) {
            console.error('‚ùå Errore caricamento logo:', error);
            logoImage = null;
            resolve(); // Continua senza logo
        };
        
        // Carica il logo WEBP
        img.src = LOGO_WEBP_BASE64;
    });
}

function toggleSindacatoField() {
    const isIscritto = document.querySelector('input[name="iscritto"]:checked')?.value;
    const sindacatoField = document.getElementById('sindacato-field');
    const sindacatoAltroField = document.getElementById('sindacato-altro-field');
    
    if (isIscritto === 'si') {
        sindacatoField.classList.add('show');
    } else {
        sindacatoField.classList.remove('show');
        sindacatoAltroField.style.display = 'none';
        document.getElementById('sindacato-select').value = '';
        document.getElementById('sindacato-nome').value = '';
    }
}

function toggleAltroSindacato() {
    const selectValue = document.getElementById('sindacato-select').value;
    const sindacatoAltroField = document.getElementById('sindacato-altro-field');
    
    if (selectValue === 'altro') {
        sindacatoAltroField.style.display = 'block';
        sindacatoAltroField.classList.add('show');
        document.getElementById('sindacato-nome').required = true;
    } else {
        sindacatoAltroField.style.display = 'none';
        sindacatoAltroField.classList.remove('show');
        document.getElementById('sindacato-nome').value = '';
        document.getElementById('sindacato-nome').required = false;
    }
}

function showConditionalFields() {
    const isIscritto = formData.iscritto === 'si';
    
    const statoCivileField = document.getElementById('stato-civile-field');
    const residenzaFields = document.getElementById('residenza-fields');
    
    if (isIscritto) {
        statoCivileField.classList.add('show');
        residenzaFields.classList.add('show');
    } else {
        statoCivileField.classList.remove('show');
        residenzaFields.classList.remove('show');
    }
}

function initSignaturePad() {
    const canvas = document.getElementById('signature-canvas');
    if (!canvas) {
        console.error('Canvas non trovato');
        return;
    }
    
    const isMobile = window.innerWidth <= 768;
    if (isMobile) {
        canvas.width = Math.min(window.innerWidth - 60, 500);
        canvas.height = 150;
    } else {
        canvas.width = 600;
        canvas.height = 200;
    }
    
    signaturePad = new SignaturePad(canvas, {
        backgroundColor: 'rgb(255, 255, 255)',
        penColor: 'rgb(0, 0, 0)',
        minWidth: isMobile ? 1.5 : 1,
        maxWidth: isMobile ? 4 : 3,
        throttle: 0,
        minDistance: 0
    });
    
    canvas.addEventListener('touchstart', function(e) {
        e.preventDefault();
    }, { passive: false });
    
    canvas.addEventListener('touchmove', function(e) {
        e.preventDefault();
    }, { passive: false });
    
    console.log('SignaturePad inizializzato correttamente');
}

window.onload = function() {
    console.log('Pagina caricata');
    initSignaturePad();
    
    loadLogo().then(() => {
        console.log('Logo pronto per l\'uso nei PDF');
    }).catch(() => {
        console.warn('Logo non caricato, il PDF verr√† generato senza logo');
    });
    
    const maxDate = new Date().toISOString().split('T')[0];
    document.getElementById('data-nascita').max = maxDate;
    
    console.log('jsPDF disponibile:', typeof window.jspdf !== 'undefined');
    console.log('SignaturePad disponibile:', typeof SignaturePad !== 'undefined');
    
    window.addEventListener('resize', function() {
        if (currentStep === 4 && signaturePad) {
            const wasEmpty = signaturePad.isEmpty();
            const data = wasEmpty ? null : signaturePad.toData();
            initSignaturePad();
            if (data && !wasEmpty) {
                signaturePad.fromData(data);
            }
        }
    });
};

function clearSignature() {
    if (signaturePad) {
        signaturePad.clear();
        console.log('Firma cancellata');
    }
}

// Funzioni per gestire upload documenti
function openCamera(tipo) {
    document.getElementById(`doc-${tipo}-camera`).click();
}

function handleFileUpload(input, tipo) {
    const file = input.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(e) {
        const imageData = e.target.result;
        
        // Mostra anteprima
        const previewDiv = document.getElementById(`preview-${tipo}`);
        const previewImg = document.getElementById(`preview-${tipo}-img`);
        previewImg.src = imageData;
        previewDiv.style.display = 'block';
        
        // Salva l'immagine
        if (tipo === 'fronte') {
            documentoFronteImage = imageData;
            console.log('‚úÖ Documento fronte caricato');
        } else {
            documentoRetroImage = imageData;
            console.log('‚úÖ Documento retro caricato');
        }
    };
    reader.readAsDataURL(file);
}

function removeDocument(tipo) {
    const previewDiv = document.getElementById(`preview-${tipo}`);
    const previewImg = document.getElementById(`preview-${tipo}-img`);
    
    previewDiv.style.display = 'none';
    previewImg.src = '';
    
    // Reset input files
    document.getElementById(`doc-${tipo}-file`).value = '';
    document.getElementById(`doc-${tipo}-camera`).value = '';
    
    if (tipo === 'fronte') {
        documentoFronteImage = null;
        console.log('‚ùå Documento fronte rimosso');
    } else {
        documentoRetroImage = null;
        console.log('‚ùå Documento retro rimosso');
    }
}

function autoCropDocument(tipo) {
    // Verifica che OpenCV sia caricato
    if (typeof cv === 'undefined') {
        alert('‚è≥ Il sistema di ritaglio automatico si sta caricando... Riprova tra qualche secondo.');
        return;
    }
    
    const previewImg = document.getElementById(`preview-${tipo}-img`);
    if (!previewImg.src) {
        alert('‚ö†Ô∏è Nessuna immagine da ritagliare');
        return;
    }
    
    try {
        // Mostra loading
        const originalSrc = previewImg.src;
        
        // Crea un'immagine temporanea per elaborazione
        const img = new Image();
        img.onload = function() {
            try {
                // Converti in Mat OpenCV
                const src = cv.imread(img);
                const dst = new cv.Mat();
                const gray = new cv.Mat();
                const edges = new cv.Mat();
                
                // Converti in scala di grigi
                cv.cvtColor(src, gray, cv.COLOR_RGBA2GRAY);
                
                // Applica blur per ridurre il rumore
                cv.GaussianBlur(gray, gray, new cv.Size(5, 5), 0);
                
                // Rileva i bordi
                cv.Canny(gray, edges, 50, 150);
                
                // Trova i contorni
                const contours = new cv.MatVector();
                const hierarchy = new cv.Mat();
                cv.findContours(edges, contours, hierarchy, cv.RETR_EXTERNAL, cv.CHAIN_APPROX_SIMPLE);
                
                // Trova il contorno pi√π grande (presumibilmente il documento)
                let maxArea = 0;
                let maxContourIndex = -1;
                
                for (let i = 0; i < contours.size(); i++) {
                    const area = cv.contourArea(contours.get(i));
                    if (area > maxArea) {
                        maxArea = area;
                        maxContourIndex = i;
                    }
                }
                
                if (maxContourIndex !== -1 && maxArea > 1000) {
                    // Ottieni il rettangolo del contorno
                    const rect = cv.boundingRect(contours.get(maxContourIndex));
                    
                    // Aggiungi un piccolo margine
                    const margin = 10;
                    const x = Math.max(0, rect.x - margin);
                    const y = Math.max(0, rect.y - margin);
                    const width = Math.min(src.cols - x, rect.width + margin * 2);
                    const height = Math.min(src.rows - y, rect.height + margin * 2);
                    
                    // Ritaglia
                    const rectRegion = new cv.Rect(x, y, width, height);
                    const cropped = src.roi(rectRegion);
                    
                    // Converti in canvas e poi in base64
                    const canvas = document.createElement('canvas');
                    cv.imshow(canvas, cropped);
                    const croppedData = canvas.toDataURL('image/jpeg', 0.9);
                    
                    // Aggiorna l'anteprima
                    previewImg.src = croppedData;
                    
                    // Salva l'immagine ritagliata
                    if (tipo === 'fronte') {
                        documentoFronteImage = croppedData;
                    } else {
                        documentoRetroImage = croppedData;
                    }
                    
                    console.log('‚úÇÔ∏è Documento ritagliato automaticamente');
                    
                    // Cleanup
                    cropped.delete();
                } else {
                    alert('‚ö†Ô∏è Non sono riuscito a rilevare il documento. Prova a scattare una foto con pi√π contrasto.');
                }
                
                // Cleanup
                src.delete();
                dst.delete();
                gray.delete();
                edges.delete();
                contours.delete();
                hierarchy.delete();
                
            } catch (err) {
                console.error('Errore nel ritaglio:', err);
                alert('‚ùå Errore nel ritaglio automatico. L\'immagine originale √® stata mantenuta.');
            }
        };
        
        img.src = originalSrc;
        
    } catch (err) {
        console.error('Errore:', err);
        alert('‚ùå Errore nel ritaglio automatico. Riprova o usa l\'immagine cos√¨ com\'√®.');
    }
}

// Funzione legacy per compatibilit√†
function previewFile(input, previewId) {
    const tipo = previewId.includes('fronte') ? 'fronte' : 'retro';
    handleFileUpload(input, tipo);
}

function updateProgress() {
    const progress = (currentStep / totalSteps) * 100;
    document.getElementById('progress').style.width = progress + '%';
}

function showStep(step) {
    document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
    document.getElementById('step' + step).classList.add('active');
    updateProgress();
    
    if (step === 4 && !signaturePad) {
        setTimeout(initSignaturePad, 100);
    }
    
    if (step === 2) {
        showConditionalFields();
    }
}

function validateStep1() {
    if (!document.querySelector('input[name="iscritto"]:checked')) {
        alert('‚ö†Ô∏è Seleziona un\'opzione');
        return false;
    }
    
    const isIscritto = document.querySelector('input[name="iscritto"]:checked').value;
    if (isIscritto === 'si') {
        const sindacatoSelect = document.getElementById('sindacato-select').value;
        
        if (!sindacatoSelect) {
            alert('‚ö†Ô∏è Seleziona un sindacato dalla lista');
            return false;
        }
        
        if (sindacatoSelect === 'altro') {
            const sindacatoNome = document.getElementById('sindacato-nome').value.trim();
            if (!sindacatoNome) {
                alert('‚ö†Ô∏è Inserisci il nome completo del sindacato');
                return false;
            }
        }
    }
    
    return true;
}

function validateStep2() {
    const nome = document.getElementById('nome').value.trim();
    const cognome = document.getElementById('cognome').value.trim();
    const grado = document.getElementById('grado').value;
    const natoA = document.getElementById('nato-a').value.trim();
    const provinciaNascita = document.getElementById('provincia-nascita').value;
    const dataNascita = document.getElementById('data-nascita').value;
    const cip = document.getElementById('cip').value.trim();
    const codiceFiscale = document.getElementById('codice-fiscale').value.trim();
    
    if (!nome || !cognome || !grado || !natoA || !provinciaNascita || !dataNascita || !cip || !codiceFiscale) {
        alert('‚ö†Ô∏è Compila tutti i campi obbligatori');
        return false;
    }
    
    const cipRegex = /^[0-9]{6}[A-Z]{2}$/;
    if (!cipRegex.test(cip.toUpperCase())) {
        alert('‚ö†Ô∏è Il C.I.P. deve essere formato da 6 numeri seguiti da 2 lettere (es: 352412YH)');
        return false;
    }
    
    if (codiceFiscale.length !== 16) {
        alert('‚ö†Ô∏è Il codice fiscale deve essere di 16 caratteri');
        return false;
    }
    
    if (formData.iscritto === 'si') {
        const statoCivile = document.getElementById('stato-civile').value;
        if (!statoCivile) {
            alert('‚ö†Ô∏è Seleziona lo stato civile');
            return false;
        }
        
        const residenzaCitta = document.getElementById('residenza-citta').value.trim();
        const residenzaProv = document.getElementById('residenza-prov').value;
        const residenzaIndirizzo = document.getElementById('residenza-indirizzo').value.trim();
        
        if (!residenzaCitta || !residenzaProv || !residenzaIndirizzo) {
            alert('‚ö†Ô∏è Compila tutti i dati di residenza');
            return false;
        }
    }
    
    return true;
}

function validateStep3() {
    const reparto = document.getElementById('reparto').value.trim();
    const regione = document.getElementById('regione').value;
    const citta = document.getElementById('citta').value.trim();
    const cap = document.getElementById('cap').value.trim();
    const cellulare = document.getElementById('cellulare').value.trim();
    const email = document.getElementById('email').value.trim();
    
    if (!reparto || !regione || !citta || !cap || !cellulare || !email) {
        alert('‚ö†Ô∏è Compila tutti i campi obbligatori');
        return false;
    }
    
    if (cap.length !== 5) {
        alert('‚ö†Ô∏è Il CAP deve essere di 5 cifre');
        return false;
    }
    
    return true;
}

function validateStep4() {
    if (!signaturePad) {
        alert('‚ö†Ô∏è Errore: firma non inizializzata. Ricarica la pagina.');
        return false;
    }
    if (signaturePad.isEmpty()) {
        alert('‚ö†Ô∏è Inserisci la firma nel riquadro bianco');
        return false;
    }
    if (!document.getElementById('luogo-firma').value.trim()) {
        alert('‚ö†Ô∏è Inserisci il luogo');
        return false;
    }
    if (!documentoFronteImage) {
        alert('‚ö†Ô∏è Carica o scatta la foto del documento fronte');
        return false;
    }
    if (!documentoRetroImage) {
        alert('‚ö†Ô∏è Carica o scatta la foto del documento retro');
        return false;
    }
    signatureImage = signaturePad.toDataURL('image/png');
    console.log('Firma salvata con successo');
    console.log('Documenti verificati: Fronte e Retro OK');
    return true;
}

function validateCurrentStep() {
    if (currentStep === 1) return validateStep1();
    if (currentStep === 2) return validateStep2();
    if (currentStep === 3) return validateStep3();
    if (currentStep === 4) return validateStep4();
    return true;
}

function saveStepData() {
    if (currentStep === 1) {
        formData.iscritto = document.querySelector('input[name="iscritto"]:checked').value;
        if (formData.iscritto === 'si') {
            const selectValue = document.getElementById('sindacato-select').value;
            if (selectValue === 'altro') {
                formData.sindacatoNome = document.getElementById('sindacato-nome').value;
            } else {
                formData.sindacatoNome = selectValue;
            }
        }
    } else if (currentStep === 2) {
        formData.nome = document.getElementById('nome').value;
        formData.cognome = document.getElementById('cognome').value;
        formData.grado = document.getElementById('grado').value;
        formData.natoA = document.getElementById('nato-a').value;
        formData.provinciaNascita = document.getElementById('provincia-nascita').value;
        formData.dataNascita = document.getElementById('data-nascita').value;
        formData.cip = document.getElementById('cip').value.toUpperCase();
        formData.codiceFiscale = document.getElementById('codice-fiscale').value.toUpperCase();
        if (formData.iscritto === 'si') {
            formData.statoCivile = document.getElementById('stato-civile').value;
            formData.residenzaCitta = document.getElementById('residenza-citta').value;
            formData.residenzaProv = document.getElementById('residenza-prov').value;
            formData.residenzaIndirizzo = document.getElementById('residenza-indirizzo').value;
        }
    } else if (currentStep === 3) {
        formData.reparto = document.getElementById('reparto').value;
        formData.regione = document.getElementById('regione').value;
        formData.citta = document.getElementById('citta').value;
        formData.provincia = document.getElementById('provincia').value;
        formData.cap = document.getElementById('cap').value;
        formData.cellulare = document.getElementById('cellulare').value;
        formData.email = document.getElementById('email').value;
        formData.ausiliaria = document.querySelector('input[name="ausiliaria"]:checked')?.value || 'no';
    } else if (currentStep === 4) {
        formData.luogoFirma = document.getElementById('luogo-firma').value;
        formData.dataFirma = new Date().toLocaleDateString('it-IT');
    }
}

function nextStep() {
    if (!validateCurrentStep()) {
        return;
    }

    saveStepData();

    if (currentStep === 4) {
        showSummary();
        currentStep = 5;
    } else {
        currentStep++;
    }

    showStep(currentStep);
}

function prevStep() {
    if (currentStep === 5) {
        currentStep = 4;
    } else {
        currentStep--;
    }
    showStep(currentStep);
}

function showSummary() {
    let html = '<h3>üìã I tuoi dati</h3>';
    
    html += `
        <div class="summary-item">
            <span class="summary-label">Nome completo:</span>
            <span class="summary-value">${formData.nome} ${formData.cognome}</span>
        </div>
        <div class="summary-item">
            <span class="summary-label">Grado:</span>
            <span class="summary-value">${formData.grado}</span>
        </div>
        <div class="summary-item">
            <span class="summary-label">Nato/a a:</span>
            <span class="summary-value">${formData.natoA} (${formData.provinciaNascita}) - ${formatDate(formData.dataNascita)}</span>
        </div>
        <div class="summary-item">
            <span class="summary-label">Reparto:</span>
            <span class="summary-value">${formData.reparto}</span>
        </div>
        <div class="summary-item">
            <span class="summary-label">Email:</span>
            <span class="summary-value">${formData.email}</span>
        </div>
    `;
    
    if (formData.iscritto === 'si') {
        html += `
            <h3 style="margin-top: 20px;">üìÑ Revoca delega</h3>
            <div class="summary-item">
                <span class="summary-label">Sindacato attuale:</span>
                <span class="summary-value">${formData.sindacatoNome}</span>
            </div>
        `;
        document.getElementById('pdf-count').textContent = '2';
    } else {
        document.getElementById('pdf-count').textContent = '1';
    }
    
    document.getElementById('summary-content').innerHTML = html;
}

function formatDate(dateString) {
    if (!dateString) return '';
    const date = new Date(dateString + 'T00:00:00');
    return date.toLocaleDateString('it-IT');
}

// Funzione per download manuale
function downloadPDFManually(blob, filename) {
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

async function generateDocuments() {
    console.log('=== INIZIO GENERAZIONE DOCUMENTI ===');
    document.getElementById('loading').style.display = 'flex';
    
    try {
        if (typeof window.jspdf === 'undefined') {
            throw new Error('jsPDF non √® stato caricato correttamente');
        }
        
        const { jsPDF } = window.jspdf;
        console.log('jsPDF caricato:', jsPDF);
        
        if (!signatureImage) {
            throw new Error('Firma non disponibile');
        }
        
        console.log('Generazione Delega Adesione...');
        generatePDFDelega(jsPDF);
        
        if (formData.iscritto === 'si') {
            await new Promise(resolve => setTimeout(resolve, 1000));
            console.log('Generazione Revoca Delega...');
            generatePDFRevoca(jsPDF);
        }
        
        currentStep = 6;
        showStep(6);
        
        let downloadListHTML = '<h4 style="margin-bottom: 15px; color: #1f2937;">üìÑ File scaricati:</h4><ul style="text-align: left;">';
        downloadListHTML += '<li style="margin: 8px 0; font-size: 16px;">‚úÖ Delega_Adesione_' + formData.cognome + '.pdf</li>';
        if (formData.iscritto === 'si') {
            downloadListHTML += '<li style="margin: 8px 0; font-size: 16px;">‚úÖ Revoca_Delega_' + formData.cognome + '.pdf</li>';
        }
        downloadListHTML += '</ul>';
        document.getElementById('download-list').innerHTML = downloadListHTML;
        
        // PULSANTI DOWNLOAD MANUALE
        let manualButtonsHTML = '';
        if (pdfBlobDelega) {
            manualButtonsHTML += '<button class="btn-download" onclick="downloadPDFManually(pdfBlobDelega, \'Delega_Adesione_' + formData.cognome + '.pdf\')">‚¨áÔ∏è Scarica Delega Adesione</button>';
        }
        if (pdfBlobRevoca) {
            manualButtonsHTML += '<button class="btn-download" onclick="downloadPDFManually(pdfBlobRevoca, \'Revoca_Delega_' + formData.cognome + '.pdf\')">‚¨áÔ∏è Scarica Revoca Delega</button>';
        }
        document.getElementById('manual-download-buttons').innerHTML = manualButtonsHTML;
        
        // Email precompilata
        const emailTo = 'tesseramenti@simcarabinieri.cc';
        const emailSubject = `Adesione SIM Carabinieri - ${formData.cognome} ${formData.nome}`;
        
        // Configura le icone
        if (WHATSAPP_ICON) {
            document.getElementById('whatsapp-icon').src = WHATSAPP_ICON;
        }
        if (TELEGRAM_ICON) {
            document.getElementById('telegram-icon').src = TELEGRAM_ICON;
        }
        
        // Prepara nome completo
        const nomeCompleto = `${formData.nome} ${formData.cognome}`;
        
        // EMAIL con nome
        const emailBody = `Gentile destinatario,\n\nsono ${nomeCompleto} e ti invio i documenti per la mia iscrizione al SIM Carabinieri.\n\nIn allegato troverai:\n${formData.iscritto === 'si' ? '- Delega di adesione\n- Revoca delega sindacato precedente' : '- Delega di adesione'}\n\nCordiali saluti,\n${nomeCompleto}`;
        const mailtoLink = `mailto:${emailTo}?subject=${encodeURIComponent(emailSubject)}&body=${encodeURIComponent(emailBody)}`;
        
        document.getElementById('email-button').onclick = function() {
            window.location.href = mailtoLink;
        };
        
        // WHATSAPP con nome
        const whatsappMessage = `Ciao! Sono ${nomeCompleto}. Ecco i documenti della mia iscrizione al SIM Carabinieri üéñÔ∏è`;
        document.getElementById('whatsapp-button').onclick = function() {
            const whatsappLink = `https://wa.me/?text=${encodeURIComponent(whatsappMessage)}`;
            window.open(whatsappLink, '_blank');
        };
        
        // TELEGRAM con nome
        const telegramMessage = `${nomeCompleto} - Documenti iscrizione SIM Carabinieri #maipi√πsoli üáÆüáπ`;
        document.getElementById('telegram-button').onclick = function() {
            const telegramLink = `https://t.me/share/url?url=${encodeURIComponent(window.location.href)}&text=${encodeURIComponent(telegramMessage)}`;
            window.open(telegramLink, '_blank');
        };
        
        console.log('=== DOCUMENTI GENERATI CON SUCCESSO ===');
        
    } catch (error) {
        console.error('Errore dettagliato:', error);
        alert('‚ùå Errore nella generazione dei PDF: ' + error.message);
    } finally {
        document.getElementById('loading').style.display = 'none';
    }
}

function generatePDFDelega(jsPDF) {
    const doc = new jsPDF();
    let y = 5;
    
    // LOGO IN ALTO AL CENTRO
   console.log('üîç Verifica logo disponibile:', logoImage ? 'S√å' : 'NO');
    if (logoImage) {
        try {
            const logoWidth = 50;  // Aumentato da 30 a 40
            const logoHeight = 40; // Aumentato da 30 a 40
            const logoX = (210 - logoWidth) / 2;
            doc.addImage(logoImage, 'PNG', logoX, y, logoWidth, logoHeight);
            y += logoHeight + 8;
            console.log('‚úÖ Logo inserito nel PDF Delega alle coordinate:', logoX, y);
        } catch (error) {
            console.error('‚ùå Errore inserimento logo nel PDF:', error);
            y += 8;
        }
    } else {
        console.warn('‚ö†Ô∏è Logo non disponibile, PDF generato senza logo');
        y += 8;
    }
    
    doc.setFontSize(12);
    doc.setFont('helvetica', 'bold');
    doc.text('DELEGA DI ADESIONE AL', 105, y, { align: 'center' });
    y += 6;
    doc.text('SINDACATO ITALIANO DEI MILITARI CARABINIERI', 105, y, { align: 'center' });
    y += 6;
    doc.text('Via Magnagrecia n.13, 00183 Roma', 105, y, { align: 'center' });
    y += 12;
    
    doc.setFontSize(10);
    doc.setFont('helvetica', 'normal');
    doc.text('Grado', 20, y);
    // SFONDO PER GRADO
    doc.setFillColor(232, 244, 248);
    doc.rect(37, y - 4, doc.getTextWidth(formData.grado.toUpperCase()) + 4, 5, 'F');
    doc.setFont('helvetica', 'bold');
    doc.text(formData.grado.toUpperCase(), 38, y);
    // SOTTOLINEATURA COMPLETA DA MARGINE A MARGINE
    doc.line(20, y + 2, 190, y + 2);
    doc.setFont('helvetica', 'normal');
    y += 8;
    
    doc.text('IL/LA SOTTOSCRITTO/A NOME ', 20, y);
    // SFONDO PER NOME
    doc.setFillColor(232, 244, 248);
    doc.rect(76, y - 4, doc.getTextWidth(formData.nome.toUpperCase()) + 4, 5, 'F');
    doc.setFont('helvetica', 'bold');
    doc.text(formData.nome.toUpperCase(), 77, y);
    doc.setFont('helvetica', 'normal');
    doc.text(' COGNOME ', 115, y);
    // SFONDO PER COGNOME
    doc.setFillColor(232, 244, 248);
    doc.rect(139, y - 4, doc.getTextWidth(formData.cognome.toUpperCase()) + 4, 5, 'F');
    doc.setFont('helvetica', 'bold');
    doc.text(formData.cognome.toUpperCase(), 140, y);
    // SOTTOLINEATURA COMPLETA DA MARGINE A MARGINE
    doc.line(20, y + 2, 190, y + 2);
    doc.setFont('helvetica', 'normal');
    y += 7;
    
    doc.text('NATO/A A ', 20, y);
    // SFONDO PER LUOGO NASCITA
    doc.setFillColor(232, 244, 248);
    doc.rect(37, y - 4, doc.getTextWidth(formData.natoA.toUpperCase()) + 4, 5, 'F');
    doc.setFont('helvetica', 'bold');
    doc.text(formData.natoA.toUpperCase(), 38, y);
    doc.setFont('helvetica', 'normal');
    doc.text(' PROV. ', 80, y);
    // SFONDO PER PROVINCIA NASCITA
    doc.setFillColor(232, 244, 248);
    doc.rect(94, y - 4, doc.getTextWidth(formData.provinciaNascita.toUpperCase()) + 4, 5, 'F');
    doc.setFont('helvetica', 'bold');
    doc.text(formData.provinciaNascita.toUpperCase(), 95, y);
    doc.setFont('helvetica', 'normal');
    doc.text(' IL ', 105, y);
    // SFONDO PER DATA NASCITA
    const dataNascitaFormatted = formatDate(formData.dataNascita);
    doc.setFillColor(232, 244, 248);
    doc.rect(114, y - 4, doc.getTextWidth(dataNascitaFormatted) + 4, 5, 'F');
    doc.setFont('helvetica', 'bold');
    doc.text(dataNascitaFormatted, 115, y);
    // SOTTOLINEATURA COMPLETA DA MARGINE A MARGINE
    doc.line(20, y + 2, 190, y + 2);
    doc.setFont('helvetica', 'normal');
    y += 7;
    
    doc.text('C.I.P. ', 20, y);
    // SFONDO PER CIP
    doc.setFillColor(232, 244, 248);
    doc.rect(34, y - 4, doc.getTextWidth(formData.cip.toUpperCase()) + 4, 5, 'F');
    doc.setFont('helvetica', 'bold');
    doc.text(formData.cip.toUpperCase(), 35, y);
    doc.setFont('helvetica', 'normal');
    doc.text(' CODICE FISCALE ', 75, y);
    // SFONDO PER CODICE FISCALE
    doc.setFillColor(232, 244, 248);
    doc.rect(109, y - 4, doc.getTextWidth(formData.codiceFiscale.toUpperCase()) + 4, 5, 'F');
    doc.setFont('helvetica', 'bold');
    doc.text(formData.codiceFiscale.toUpperCase(), 110, y);
    // SOTTOLINEATURA COMPLETA DA MARGINE A MARGINE
    doc.line(20, y + 2, 190, y + 2);
    doc.setFont('helvetica', 'normal');
    y += 7;
    
    doc.text('REPARTO DI APPARTENENZA ', 20, y);
    // SFONDO PER REPARTO
    doc.setFillColor(232, 244, 248);
    doc.rect(72, y - 4, doc.getTextWidth(formData.reparto.toUpperCase()) + 4, 5, 'F');
    doc.setFont('helvetica', 'bold');
    doc.text(formData.reparto.toUpperCase(), 73, y);
    doc.setFont('helvetica', 'normal');
    doc.text(' CAP ', 145, y);
    // SFONDO PER CAP
    doc.setFillColor(232, 244, 248);
    doc.rect(159, y - 4, doc.getTextWidth(formData.cap) + 4, 5, 'F');
    doc.setFont('helvetica', 'bold');
    doc.text(formData.cap, 160, y);
    // SOTTOLINEATURA COMPLETA DA MARGINE A MARGINE
    doc.line(20, y + 2, 190, y + 2);
    doc.setFont('helvetica', 'normal');
    y += 7;
    
    doc.text('REGIONE ', 20, y);
    // SFONDO PER REGIONE
    doc.setFillColor(232, 244, 248);
    doc.rect(39, y - 4, doc.getTextWidth(formData.regione.toUpperCase()) + 4, 5, 'F');
    doc.setFont('helvetica', 'bold');
    doc.text(formData.regione.toUpperCase(), 40, y);
    doc.setFont('helvetica', 'normal');
    doc.text(' CITTA\' ', 85, y);
    // SFONDO PER CITT√Ä
    doc.setFillColor(232, 244, 248);
    doc.rect(101, y - 4, doc.getTextWidth(formData.citta.toUpperCase()) + 4, 5, 'F');
    doc.setFont('helvetica', 'bold');
    doc.text(formData.citta.toUpperCase(), 102, y);
    doc.setFont('helvetica', 'normal');
    doc.text(' PROV. ', 145, y);
    // SFONDO PER PROVINCIA
    doc.setFillColor(232, 244, 248);
    doc.rect(161, y - 4, doc.getTextWidth(formData.provincia.toUpperCase()) + 4, 5, 'F');
    doc.setFont('helvetica', 'bold');
    doc.text(formData.provincia.toUpperCase(), 162, y);
    // SOTTOLINEATURA COMPLETA DA MARGINE A MARGINE
    doc.line(20, y + 2, 190, y + 2);
    doc.setFont('helvetica', 'normal');
    y += 7;
    
    doc.text('CELL. ', 20, y);
    // SFONDO PER CELLULARE
    doc.setFillColor(232, 244, 248);
    doc.rect(34, y - 4, doc.getTextWidth(formData.cellulare) + 4, 5, 'F');
    doc.setFont('helvetica', 'bold');
    doc.text(formData.cellulare, 35, y);
    doc.setFont('helvetica', 'normal');
    doc.text(' E-MAIL ', 80, y);
    // SFONDO PER EMAIL
    doc.setFillColor(232, 244, 248);
    doc.rect(99, y - 4, doc.getTextWidth(formData.email) + 4, 5, 'F');
    doc.setFont('helvetica', 'bold');
    doc.text(formData.email, 100, y);
    // SOTTOLINEATURA COMPLETA DA MARGINE A MARGINE
    doc.line(20, y + 2, 190, y + 2);
    doc.setFont('helvetica', 'normal');
    y += 10;
    
    doc.setFontSize(9);
    doc.text('Spuntare se in ausiliaria- SI', 20, y);
    
    doc.rect(68, y - 3, 4, 4);
    doc.text('NO', 80, y);
    doc.rect(88, y - 3, 4, 4);
    
    doc.setFontSize(12);
    doc.setFont('helvetica', 'bold');
    if (formData.ausiliaria === 'si') {
        doc.text('X', 68.5, y + 0.2);
    } else {
        doc.text('X', 88.5, y + 0.2);
    }
    doc.setFontSize(9);
    doc.setFont('helvetica', 'normal');
    y += 10;
    
    const testo1 = doc.splitTextToSize(
        'Con il presente atto aderisce al Sindacato Italiano Militari Carabinieri ‚Äì S.I.M. Carabinieri ‚ÄìVia Magnagrecia n. 13, 00183 Roma',
        170
    );
    doc.text(testo1, 20, y);
    y += testo1.length * 4 + 3;
    
    doc.setFont('helvetica', 'bold');
    doc.text('Codice Fiscale: 96408280582.', 20, y);
    y += 5;
    doc.text('A tal fine rilascia delega ed autorizza l\'Amministrazione dell\'Arma dei Carabinieri a:', 20, y);
    y += 6;
    
    doc.setFont('helvetica', 'normal');
    const testo2 = doc.splitTextToSize(
        '- trattenere mensilmente dal proprio statino paga e per le 12 mensilit√†, lo 0,50% della voce stipendio o del trattamento pensionistico da considerare al netto di tutte le ritenute fiscali e contributive riferita agli emolumenti fissi e continuativi cos√¨ come stabilito dai competenti organi statutari in analogia alle leggi di settore vigenti, ai sensi dell\'art. 13 co. 3 della Legge n. 46 del 28 aprile 2022;',
        170
    );
    
    const testo2Height = testo2.length * 4;
    const padding = 2;
    
    doc.setFillColor(240, 240, 240);
    doc.rect(18, y - 3, 174, testo2Height + padding, 'F');
    
    doc.text(testo2, 20, y);
    y += testo2Height + 4;
    
    const testo3 = doc.splitTextToSize(
        '- versare la suddetta quota sul conto corrente bancario intestato a S.I.M. Carabinieri IBAN IT66 B0878739 0900 0000 0015819 ai sensi dell\'art. 7 co. 4. della Legge n. 46 del 28 aprile 2022 e D.M. conseguente.',
        170
    );
    
    const testo4 = doc.splitTextToSize(
        'Validit√† temporale della delega. La presente delega ha validit√† dal primo giorno del mese successivo a quello del rilascio fino al 31 dicembre di ogni anno e si intende tacitamente rinnovata se non √® revocata dall\'interessato entro il 31 ottobre, ai sensi dell\'art. 7 co. 3. della Legge n. 46 del 28 aprile 2022.',
        170
    );
    
    const testo3Height = testo3.length * 4;
    const testo4Height = testo4.length * 4;
    const totalRedBoxHeight = testo3Height + testo4Height + 10;
    const redPadding = 3;
    
    doc.setDrawColor(255, 0, 0);
    doc.setLineWidth(0.5);
    doc.rect(17, y - 3, 176, totalRedBoxHeight + redPadding, 'S');
    
    doc.text(testo3, 20, y);
    y += testo3Height + 5;
    
    doc.text(testo4, 20, y);
    y += testo4Height + 8;
    
    doc.setDrawColor(0, 0, 0);
    
    const testo5 = doc.splitTextToSize(
        'L\'eventuale revoca della delega dovr√† essere trasmessa, in forma scritta, all\'amministrazione e al S.I.M Carabinieri presso la sede legale nazionale Via Magnagrecia n. 13, 00183 Roma con raccomandata A/R o con PEC. ai sensi dell\'art. art. 7 co. 3 della legge n. 46 del 28 aprile 2022.',
        170
    );
    doc.text(testo5, 20, y);
    y += testo5.length * 4 + 8;
    
    doc.text(formData.luogoFirma + ', ' + formData.dataFirma, 20, y);
    doc.text('Firma', 140, y);
    doc.line(155, y, 190, y);
    if (signatureImage) {
        doc.addImage(signatureImage, 'PNG', 155, y - 8, 35, 10);
    }
    y += 12;
    
    doc.setFontSize(8);
    const testo6 = doc.splitTextToSize(
        'Dichiara di aver preso visione dello Statuto presente sul sito internet www.simcarabinieri.com, dell\'allegato "A" relativo alle competenze stipendiali per il calcolo della base della quota associativa, ricevuto ed accettato copia dell\'allegata informativa sul trattamento dei dati personali. Prende atto, altres√¨, di quanto stabilito dall\'art. 3, comma 3, del DM Difesa 26 luglio 2022, per il quale "ai sensi di quanto disposto dall\'art. 1, comma 4 della Legge √® ammessa un\'unica delega su una singola retribuzione o trattamento pensionistico.',
        170
    );
    doc.text(testo6, 20, y);
    y += testo6.length * 3.5 + 8;
    
    doc.setFontSize(9);
    doc.text(formData.luogoFirma + ', ' + formData.dataFirma, 20, y);
    doc.text('Firma', 140, y);
    doc.line(155, y, 190, y);
    if (signatureImage) {
        doc.addImage(signatureImage, 'PNG', 155, y - 8, 35, 10);
    }
    y += 12;
    
    doc.setFontSize(8);
    const footer = doc.splitTextToSize(
        'La presente delega, compilata, sottoscritta e corredata dal documento di identit√†, dovr√† essere acquisita con lo scanner salvata in formato PDF o .TIF e trasmessa via mail all\'indirizzo tesseramenti@simcarabinieri.cc',
        170
    );
    doc.text(footer, 20, y);
    
    doc.addPage();
    doc.setFontSize(14);
    doc.setFont('helvetica', 'bold');
    doc.text('DOCUMENTI DI IDENTIT√Ä', 105, 20, { align: 'center' });
    
    if (documentoFronteImage) {
        doc.setFontSize(10);
        doc.setFont('helvetica', 'bold');
        doc.text('FRONTE:', 20, 35);
        doc.addImage(documentoFronteImage, 'JPEG', 20, 40, 170, 110);
    }
    
    if (documentoRetroImage) {
        doc.setFont('helvetica', 'bold');
        doc.text('RETRO:', 20, 160);
        doc.addImage(documentoRetroImage, 'JPEG', 20, 165, 170, 110);
    }
    
    // Salva blob per download manuale
    pdfBlobDelega = doc.output('blob');
    
    doc.save('Delega_Adesione_' + formData.cognome + '.pdf');
    console.log('‚úÖ PDF Delega generato e scaricato');
}


function generatePDFRevoca(jsPDF) {
    const doc = new jsPDF();
    let y = 15;
    
    doc.setFillColor(220, 220, 220);
    doc.rect(20, y, 170, 15, 'F');
    doc.setFontSize(12);
    doc.setFont('helvetica', 'bold');
    doc.text('REVOCA DELEGA SINDACALE', 105, y + 6, { align: 'center' });
    doc.setFontSize(9);
    doc.setFont('helvetica', 'normal');
    doc.text('(ai sensi dell\'art.1480-quater del D.Lgs. n. 66 del 2010)', 105, y + 11, { align: 'center' });
    y += 28;
    
    doc.setFontSize(10);
    doc.setFont('helvetica', 'bold');
    
    doc.text('A', 20, y);
    
    doc.text('COMANDO GENERALE DELL\'ARMA DEI CARABINIERI', 105, y, { align: 'center' });
    y += 5;
    doc.text('CENTRO NAZIONALE AMMINISTRATIVO', 105, y, { align: 'center' });
    y += 5;
    doc.text('UFFICIO TRATTAMENTO ECONOMICO ATTIVITA\'', 105, y, { align: 'center' });
    y += 5;
    
    doc.setFont('helvetica', 'normal');
    doc.text('Viale Benedetto Croce n. 154, 66100 - CHIETI', 190, y, { align: 'right' });
    y += 12;
    
    doc.setFontSize(10);
    doc.setFont('helvetica', 'bold');
    doc.text('A', 20, y);
    doc.text(formData.sindacatoNome.toUpperCase(), 30, y);
    y += 5;
    doc.setFontSize(8);
    doc.setFont('helvetica', 'italic');
    doc.text('(denominazione e indirizzo APCSM a cui la presente istanza dovra\' essere inviata)', 20, y);
    y += 12;
    
    doc.setFontSize(10);
    doc.setFont('helvetica', 'normal');
    doc.text('Il sottoscritto:', 20, y);
    y += 8;
    
    doc.setFillColor(220, 220, 220);
    doc.rect(20, y, 170, 8, 'F');
    doc.setFontSize(9);
    doc.setFont('helvetica', 'bold');
    doc.text('DATI ANAGRAFICI DEL RICHIEDENTE', 25, y + 5);
    y += 8;
    
    const h1 = 10;
    doc.rect(20, y, 50, h1);
    doc.rect(70, y, 50, h1);
    doc.rect(120, y, 70, h1);
    
    doc.setFontSize(10);
    doc.setFont('helvetica', 'bold');
    doc.text(formData.grado.toUpperCase(), 22, y + 4);
    doc.text(formData.cip.toUpperCase(), 72, y + 4);
    doc.text(formData.codiceFiscale.toUpperCase(), 122, y + 4);
    
    doc.setFontSize(7);
    doc.setFont('helvetica', 'normal');
    doc.text('Grado', 22, y + 8);
    doc.text('c.i.p.', 72, y + 8);
    doc.text('codice fiscale', 122, y + 8);
    y += h1;
    
    doc.rect(20, y, 100, h1);
    doc.rect(120, y, 70, h1);
    
    doc.setFontSize(10);
    doc.setFont('helvetica', 'bold');
    doc.text(formData.cognome.toUpperCase() + ' ' + formData.nome.toUpperCase(), 22, y + 4);
    doc.text(formData.statoCivile.toUpperCase(), 122, y + 4);
    
    doc.setFontSize(7);
    doc.setFont('helvetica', 'normal');
    doc.text('cognome e nome', 22, y + 8);
    doc.text('stato civile', 122, y + 8);
    y += h1;
    
    doc.rect(20, y, 80, h1);
    doc.rect(100, y, 30, h1);
    doc.rect(130, y, 60, h1);
    
    doc.setFontSize(10);
    doc.setFont('helvetica', 'bold');
    doc.text(formData.natoA.toUpperCase(), 22, y + 4);
    doc.text(formData.provinciaNascita.toUpperCase(), 102, y + 4);
    doc.text(formatDate(formData.dataNascita).toUpperCase(), 132, y + 4);
    
    doc.setFontSize(7);
    doc.setFont('helvetica', 'normal');
    doc.text('nato a', 22, y + 8);
    doc.text('prov.', 102, y + 8);
    doc.text('il', 132, y + 8);
    y += h1;
    
    doc.rect(20, y, 50, h1);
    doc.rect(70, y, 30, h1);
    doc.rect(100, y, 90, h1);
    
    doc.setFontSize(10);
    doc.setFont('helvetica', 'bold');
    doc.text(formData.residenzaCitta.toUpperCase(), 22, y + 4);
    doc.text(formData.residenzaProv.toUpperCase(), 72, y + 4);
    doc.text(formData.residenzaIndirizzo.toUpperCase(), 102, y + 4);
    
    doc.setFontSize(7);
    doc.setFont('helvetica', 'normal');
    doc.text('residente a', 22, y + 8);
    doc.text('prov', 72, y + 8);
    doc.text('indirizzo', 102, y + 8);
    y += h1;
    
    doc.rect(20, y, 100, h1);
    doc.rect(120, y, 70, h1);
    
    doc.setFontSize(10);
    doc.setFont('helvetica', 'bold');
    doc.text(formData.reparto.toUpperCase(), 22, y + 4);
    doc.text(formData.email.toUpperCase(), 122, y + 4);
    
    doc.setFontSize(7);
    doc.setFont('helvetica', 'normal');
    doc.text('reparto*/posizione ausiliaria**', 22, y + 8);
    doc.text('e-mail', 122, y + 8);
    y += h1 + 8;
    
    doc.setFontSize(10);
    doc.setFont('helvetica', 'bold');
    const testoRevoca1 = doc.splitTextToSize(
        'REVOCA la delega sindacale rilasciata in favore dell\'APCSM in indirizzo e, pertanto, CHIEDE che non sia piu\' operata la relativa trattenuta mensile sul proprio stipendio/trattamento pensionistico.',
        170
    );
    doc.text(testoRevoca1, 20, y);
    y += testoRevoca1.length * 5 + 8;
    
    doc.setFont('helvetica', 'bold');
    const testoConsapevolezza = doc.splitTextToSize(
        'Il sottoscritto e\' consapevole che la presente revoca ha efficacia ai sensi e nei limiti dell\'art. 1480-quater del D.Lgs. n. 66 del 2010.',
        170
    );
    doc.text(testoConsapevolezza, 20, y);
    y += testoConsapevolezza.length * 5 + 8;
    
    doc.setFont('helvetica', 'normal');
    const testoGDPR = doc.splitTextToSize(
        'Si autorizza, ai sensi e per gli effetti degli articoli 7 e seguenti del Regolamento UE 2016/679, il trattamento dei dati personali che saranno raccolti e trattati anche con gli strumenti informatici esclusivamente nell\'ambito del procedimento per il quale la presente richiesta viene presentata.',
        170
    );
    doc.text(testoGDPR, 20, y);
    y += testoGDPR.length * 4 + 10;
    
    doc.setFontSize(9);
    doc.setFont('helvetica', 'normal');
    doc.rect(20, y, 60, 8);
    
    doc.setFont('helvetica', 'bold');
    doc.text(formData.luogoFirma.toUpperCase(), 22, y + 3);
    
    doc.setFontSize(7);
    doc.setFont('helvetica', 'normal');
    doc.text('Luogo', 22, y + 6);
    
    doc.setFontSize(9);
    doc.rect(130, y, 60, 8);
    
    doc.setFont('helvetica', 'bold');
    doc.text(formData.dataFirma, 132, y + 3);
    
    doc.setFontSize(7);
    doc.setFont('helvetica', 'normal');
    doc.text('Data', 132, y + 6);
    y += 12;
    
    doc.setFontSize(9);
    doc.setFont('helvetica', 'normal');
    doc.text('L\'interessato', 130, y);
    y += 2;
    
    if (signatureImage) {
        doc.addImage(signatureImage, 'PNG', 130, y, 60, 20);
        y += 22;
    } else {
        doc.line(130, y + 5, 190, y + 5);
        y += 10;
    }
    
    doc.setFontSize(8);
    doc.setFont('helvetica', 'bold');
    doc.text('Note:', 20, y);
    doc.setFont('helvetica', 'normal');
    const noteFinali = doc.splitTextToSize(
        'La presente revoca, compilata, sottoscritta e corredata del documento di identita\', dovra\' essere trasmessa, tramite posta elettronica certificata, all\'indirizzo cnateadeleghe@pec.carabinieri.it o con raccomandata con avviso di ricevimento ai sensi dell\'art. 3, comma 4 del DM Difesa 26 Luglio 2022.',
        170
    );
    doc.text(noteFinali, 20, y + 5);
    
    doc.addPage();
    doc.setFontSize(14);
    doc.setFont('helvetica', 'bold');
    doc.text('DOCUMENTI DI IDENTIT√Ä', 105, 20, { align: 'center' });
    
    if (documentoFronteImage) {
        doc.setFontSize(10);
        doc.setFont('helvetica', 'bold');
        doc.text('FRONTE:', 20, 35);
        doc.addImage(documentoFronteImage, 'JPEG', 20, 40, 170, 110);
    }
    
    if (documentoRetroImage) {
        doc.setFontSize(10);
        doc.setFont('helvetica', 'bold');
        doc.text('RETRO:', 20, 160);
        doc.addImage(documentoRetroImage, 'JPEG', 20, 165, 170, 110);
    }
    
    // Salva blob per download manuale
    pdfBlobRevoca = doc.output('blob');
    
    doc.save('Revoca_Delega_' + formData.cognome + '.pdf');
    console.log('‚úÖ PDF Revoca generato e scaricato');
}

updateProgress();
</script>

</body>
</html>
