<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dirigenti - SIM Carabinieri - La Tua Dirigenza Sempre Con Te</title>
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#003d82">
    <link rel="icon" href="/icons/favicon.ico" type="image/x-icon">
    
    <!-- iOS PWA Support -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="SIM Dirigenti">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800;900&family=Space+Grotesk:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        :root {
            /* SIM Color Palette */
            --primary-blue: #003d82;
            --primary-red: #8b2635;
            --accent-gold: #ffd700;
            --accent-green: #28a745;
            --neutral-white: #ffffff;
            --neutral-black: #0a0a0a;
            --neutral-gray: #8a8a8a;
            --surface-light: #f8fafc;
            --surface-dark: #1e293b;
            
            /* Gradients */
            --gradient-primary: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-red) 100%);
            --gradient-gold: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            --gradient-glass: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            
            /* Shadows */
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
            --shadow-md: 0 8px 25px rgba(0,0,0,0.08);
            --shadow-lg: 0 25px 50px rgba(0,0,0,0.12);
            --shadow-xl: 0 35px 80px rgba(0,0,0,0.15);
            
            /* Blur & Radius */
            --blur-sm: 10px;
            --blur-md: 20px;
            --blur-lg: 40px;
            --radius-sm: 12px;
            --radius-md: 20px;
            --radius-lg: 32px;
            
            /* Transitions */
            --transition-fast: 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-smooth: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-spring: 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.6;
            color: var(--neutral-black);
            background: var(--neutral-white);
            overflow-x: hidden;
        }

        /* ===== ANIMATED BACKGROUND ===== */
        .animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(-45deg, 
                var(--primary-blue), 
                #1e4a72, 
                var(--primary-red), 
                #2563eb,
                var(--primary-blue)
            );
            background-size: 400% 400%;
            animation: gradientFlow 15s ease infinite;
        }

        .animated-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 25% 75%, rgba(255,215,0,0.1) 0%, transparent 40%),
                        radial-gradient(circle at 75% 25%, rgba(40,167,69,0.05) 0%, transparent 40%),
                        radial-gradient(circle at 50% 50%, rgba(255,255,255,0.03) 0%, transparent 60%);
            animation: floatingOrbs 20s ease-in-out infinite;
        }

        @keyframes gradientFlow {
            0%, 100% { background-position: 0% 50%; }
            25% { background-position: 100% 50%; }
            50% { background-position: 100% 100%; }
            75% { background-position: 0% 100%; }
        }

        @keyframes floatingOrbs {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(180deg); }
        }

        /* ===== SMART SIDEBAR NAVIGATION ===== */
        .smart-sidebar {
            position: fixed;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1000;
            transition: var(--transition-smooth);
            opacity: 0;
            visibility: hidden;
        }

        .smart-sidebar.visible {
            opacity: 1;
            visibility: visible;
        }

        .sidebar-trigger {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            width: 40px;
            z-index: 999;
            cursor: pointer;
        }

        .sidebar-container {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(var(--blur-lg));
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 0 25px 25px 0;
            padding: 1.5rem 0.75rem;
            margin-left: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            box-shadow: var(--shadow-xl);
            transform: translateX(-100%);
            transition: var(--transition-spring);
        }

        .smart-sidebar.active .sidebar-container {
            transform: translateX(0);
        }

        .sidebar-logo {
            width: 50px;
            height: 50px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--neutral-white);
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 900;
            font-size: 0.8rem;
            text-decoration: none;
            box-shadow: var(--shadow-md);
        }

        .sidebar-nav {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .nav-item {
            position: relative;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            font-size: 1.3rem;
            transition: var(--transition-spring);
            background: transparent;
            color: var(--primary-blue);
            cursor: pointer;
        }

        .nav-item:hover {
            background: var(--primary-blue);
            color: var(--neutral-white);
            transform: scale(1.15) rotate(5deg);
        }

        .nav-tooltip {
            position: absolute;
            left: 70px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--neutral-black);
            color: var(--neutral-white);
            padding: 0.5rem 1rem;
            border-radius: var(--radius-sm);
            font-size: 0.85rem;
            font-weight: 600;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition-fast);
            pointer-events: none;
        }

        .nav-item:hover .nav-tooltip {
            opacity: 1;
            visibility: visible;
            transform: translateY(-50%) translateX(10px);
        }

        /* ===== BACK BUTTON ===== */
        .btn-back {
            display: none;
        }

        /* ===== HERO SECTION ===== */
        .hero {
            min-height: 100vh;
            display: flex;
            align-items: center;
            position: relative;
            padding: 0 2rem;
        }

        .hero-container {
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
            text-align: center;
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--gradient-gold);
            color: var(--neutral-black);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-md);
        }

        .hero-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: clamp(3rem, 8vw, 5rem);
            font-weight: 900;
            line-height: 1.1;
            color: var(--neutral-white);
            margin-bottom: 1.5rem;
            text-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .hero-title .highlight {
            background: var(--gradient-gold);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero-subtitle {
            font-size: 1.5rem;
            color: rgba(255,255,255,0.9);
            margin-bottom: 3rem;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
            font-weight: 600;
        }

        /* ===== STATS SECTION ===== */
        .stats-section {
            padding: 4rem 2rem;
            position: relative;
        }

        .stats-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin-bottom: 4rem;
        }

        .stat-card {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(var(--blur-md));
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: var(--radius-lg);
            padding: 2rem;
            text-align: center;
            box-shadow: var(--shadow-lg);
            transition: var(--transition-smooth);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
        }

        .stat-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: var(--shadow-xl);
        }

        .stat-number {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--primary-blue);
            line-height: 1;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--neutral-gray);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 0.5px;
        }

        /* ===== FILTERS SECTION ===== */
        .filters-section {
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .search-container {
            margin-bottom: 2rem;
        }

        .search-box {
            width: 100%;
            padding: 1rem 2rem;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: var(--radius-md);
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(var(--blur-md));
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--neutral-black);
            box-shadow: var(--shadow-md);
            transition: var(--transition-smooth);
        }

        .search-box:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 4px rgba(0,61,130,0.1);
        }

        .search-box::placeholder {
            color: var(--neutral-gray);
        }

        .filter-tabs {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .filter-tab {
            padding: 1rem 2rem;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: var(--radius-md);
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(var(--blur-sm));
            color: var(--neutral-white);
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition-smooth);
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .filter-tab:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .filter-tab.active {
            background: var(--gradient-gold);
            color: var(--neutral-black);
            border-color: var(--accent-gold);
            text-shadow: none;
            box-shadow: var(--shadow-lg);
        }

        /* ===== DIRIGENTI GRID ===== */
        .dirigenti-section {
            padding: 4rem 2rem;
        }

        .dirigenti-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .dirigenti-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
        }

        .dirigente-card {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(var(--blur-lg));
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: var(--radius-lg);
            padding: 2.5rem;
            position: relative;
            overflow: hidden;
            transition: var(--transition-smooth);
            cursor: pointer;
            box-shadow: var(--shadow-lg);
        }

        .dirigente-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
        }

        .dirigente-card::after {
            content: '';
            position: absolute;
            top: -100%;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            transition: top 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: -1;
        }

        .dirigente-card:hover::after {
            top: 0;
        }

        .dirigente-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: var(--shadow-xl);
            color: var(--neutral-white);
        }

        .dirigente-card:hover .dirigente-title,
        .dirigente-card:hover .dirigente-role,
        .dirigente-card:hover .dirigente-location {
            color: var(--neutral-white);
        }

        .dirigente-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: var(--gradient-gold);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: 900;
            margin: 0 auto 2rem;
            box-shadow: var(--shadow-lg);
            border: 4px solid var(--neutral-white);
            color: var(--neutral-black);
            transition: var(--transition-smooth);
        }

        .dirigente-card:hover .dirigente-avatar {
            transform: scale(1.05);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .dirigente-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary-blue);
            text-align: center;
            margin-bottom: 1rem;
        }

        .role-badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            font-weight: 700;
            font-size: 0.9rem;
            text-align: center;
            margin: 0 auto 1.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .role-regionale {
            background: var(--gradient-gold);
            color: var(--neutral-black);
        }

        .role-provinciale {
            background: var(--gradient-primary);
            color: var(--neutral-white);
        }

        .dirigente-location {
            color: var(--neutral-gray);
            text-align: center;
            margin-bottom: 2rem;
            font-weight: 600;
        }

        .contact-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .contact-button {
            flex: 1;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 700;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: var(--transition-smooth);
            cursor: pointer;
        }

        .btn-email {
            background: var(--primary-blue);
            color: var(--neutral-white);
        }

        .btn-phone {
            background: var(--accent-green);
            color: var(--neutral-white);
        }

        .contact-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* ===== LOADING & EMPTY STATES ===== */
        .loading-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
            flex-direction: column;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,255,255,0.3);
            border-left: 4px solid var(--accent-gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        .loading-text {
            color: var(--neutral-white);
            font-size: 1.2rem;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .error-container,
        .empty-container {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--neutral-white);
        }

        .error-icon,
        .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            display: block;
        }

        .error-title,
        .empty-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .error-description,
        .empty-description {
            font-size: 1.1rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .btn-retry {
            background: var(--gradient-gold);
            color: var(--neutral-black);
            padding: 1rem 2rem;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 800;
            cursor: pointer;
            transition: var(--transition-smooth);
            font-size: 1rem;
        }

        .btn-retry:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: var(--shadow-lg);
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 1024px) {
            .smart-sidebar,
            .sidebar-trigger {
                display: none;
            }
            
            .btn-back {
                top: 1rem;
                right: 1rem;
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 768px) {
            .hero {
                padding: 0 1rem;
                min-height: 80vh;
            }
            
            .stats-section,
            .filters-section,
            .dirigenti-section {
                padding: 2rem 1rem;
            }
            
            .dirigenti-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .dirigente-card {
                padding: 2rem;
            }
            
            .filter-tabs {
                flex-direction: column;
                align-items: center;
            }
            
            .filter-tab {
                width: 100%;
                max-width: 200px;
            }
        }

        @media (max-width: 480px) {
            .hero-title {
                font-size: 2.5rem;
            }
            
            .dirigente-avatar {
                width: 100px;
                height: 100px;
                font-size: 2.5rem;
            }
            
            .contact-buttons {
                flex-direction: column;
            }
            
            .contact-button {
                flex: none;
            }
        }

        /* ===== ANIMATIONS ===== */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in-up {
            animation: fadeInUp 0.6s ease-out forwards;
        }

        /* ===== UTILITY CLASSES ===== */
        .hidden {
            display: none !important;
        }

        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(var(--blur-md));
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body>
    <div class="animated-bg"></div>

    <!-- Smart Sidebar Navigation (Desktop only) -->
    <div class="sidebar-trigger" id="sidebarTrigger"></div>
    <nav class="smart-sidebar" id="smartSidebar">
        <div class="sidebar-container">
            <a href="index.html" class="sidebar-logo">
                SIM
            </a>
            
            <div class="sidebar-nav">
                <a href="index.html" class="nav-item">
                    🏠
                    <div class="nav-tooltip">Home</div>
                </a>
                <a href="#dirigenti" class="nav-item">
                    👥
                    <div class="nav-tooltip">Dirigenti</div>
                </a>
                <a href="https://www.simcarabinieri.com/iscrizione.php" class="nav-item" target="_blank">
                    📝
                    <div class="nav-tooltip">Iscriviti</div>
                </a>
            </div>
        </div>
    </nav>

    <!-- Back Button -->
    <a href="index.html" class="btn-back">
        ← Torna alla Home
    </a>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-container">
            <div class="hero-badge">
                👥 La Tua Dirigenza
            </div>
            
            <h1 class="hero-title">
                I Nostri <span class="highlight">Dirigenti</span>
            </h1>
            
            <p class="hero-subtitle">
                Esperienza, competenza e dedizione al servizio del personale dell'Arma dei Carabinieri
            </p>
        </div>
    </section>

    <!-- Stats Section -->
    <section class="stats-section">
        <div class="stats-container">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalCount">-</div>
                    <div class="stat-label">Dirigenti Totali</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="regionaliCount">-</div>
                    <div class="stat-label">Dirigenti Regionali</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="provincialiCount">-</div>
                    <div class="stat-label">Dirigenti Provinciali</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">24/7</div>
                    <div class="stat-label">Supporto Attivo</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Filters Section -->
    <section class="filters-section">
        <div class="search-container">
            <input type="text" id="searchInput" class="search-box" placeholder="🔍 Cerca dirigente per nome o provincia...">
        </div>
        
        <div class="filter-tabs">
            <button class="filter-tab active" data-filter="all">Tutti i Dirigenti</button>
            <button class="filter-tab" data-filter="Regionale">Dirigenti Regionali</button>
            <button class="filter-tab" data-filter="Provinciale">Dirigenti Provinciali</button>
        </div>
    </section>

    <!-- Dirigenti Section -->
    <section class="dirigenti-section" id="dirigenti">
        <div class="dirigenti-container">
            
            <!-- Loading State -->
            <div id="loadingContainer" class="loading-container">
                <div class="loading-spinner"></div>
                <div class="loading-text">Caricamento dirigenti...</div>
            </div>

            <!-- Error State -->
            <div id="errorContainer" class="error-container hidden">
                <div class="error-icon">⚠️</div>
                <h3 class="error-title">Errore di Caricamento</h3>
                <p class="error-description">Non è stato possibile caricare i dati dei dirigenti. Verifica la connessione e riprova.</p>
                <button class="btn-retry" onclick="window.dirigentiManager.reload()">🔄 Riprova</button>
            </div>

            <!-- Empty State -->
            <div id="emptyContainer" class="empty-container hidden">
                <div class="empty-icon">🔍</div>
                <h3 class="empty-title">Nessun Dirigente Trovato</h3>
                <p class="empty-description">Prova a modificare i filtri di ricerca o rimuovi il termine di ricerca.</p>
            </div>

            <!-- Dirigenti Grid -->
            <div id="dirigentiContainer" class="dirigenti-grid hidden">
                <!-- Le card dei dirigenti saranno inserite qui dinamicamente -->
            </div>
            
        </div>
    </section>

    <!-- JavaScript with Real Supabase Integration -->
    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

        // Configurazione Supabase corretta
        const supabaseUrl = 'https://pvzdilkozpspsnepedqc.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB2emRpbGtvenBzcHNuZXBlZHFjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ1MDY1NDUsImV4cCI6MjA3MDA4MjU0NX0.JimqeUkyOGcOw-pt-yJUVevSP3n6ikBPDR3N8y_7YIk';

        const supabase = createClient(supabaseUrl, supabaseKey);

        // Sistema di gestione dirigenti migliorato
        class DirigentiManager {
            constructor() {
                this.allDirigenti = [];
                this.filteredDirigenti = [];
                this.isLoading = false;
                this.hasError = false;
                this.currentFilter = 'all';
                
                this.init();
            }

            // Inizializzazione
            async init() {
                try {
                    console.log('🚀 Inizializzazione DirigentiManager...');
                    await this.loadDirigenti();
                    this.setupEventListeners();
                    this.setupSidebar();
                } catch (error) {
                    console.error('❌ Errore inizializzazione:', error);
                    this.showError();
                }
            }

            // Carica dirigenti da Supabase
            async loadDirigenti() {
                this.showLoading();
                
                try {
                    console.log('🔄 Caricamento dirigenti da Supabase...');
                    
                    const { data, error } = await supabase
                        .from('organico_dirigentisindacali')
                        .select('*')
                        .eq('attivo', true)
                        .order('ordine', { ascending: true });

                    if (error) {
                        throw new Error(`Errore Supabase: ${error.message}`);
                    }

                    this.allDirigenti = data || [];
                    this.filteredDirigenti = [...this.allDirigenti];
                    
                    console.log(`✅ Caricati ${this.allDirigenti.length} dirigenti da Supabase`);
                    
                    this.renderDirigenti();
                    this.updateStats();

                } catch (error) {
                    console.error('❌ Errore caricamento dirigenti:', error);
                    this.showError();
                }
            }

            // Mostra stato di caricamento
            showLoading() {
                this.isLoading = true;
                this.hasError = false;
                
                document.getElementById('loadingContainer').classList.remove('hidden');
                document.getElementById('dirigentiContainer').classList.add('hidden');
                document.getElementById('errorContainer').classList.add('hidden');
                document.getElementById('emptyContainer').classList.add('hidden');
            }

            // Mostra errore
            showError() {
                this.hasError = true;
                this.isLoading = false;
                
                document.getElementById('loadingContainer').classList.add('hidden');
                document.getElementById('dirigentiContainer').classList.add('hidden');
                document.getElementById('emptyContainer').classList.add('hidden');
                document.getElementById('errorContainer').classList.remove('hidden');
            }

            // Renderizza dirigenti
            renderDirigenti() {
                this.isLoading = false;
                this.hasError = false;
                
                const container = document.getElementById('dirigentiContainer');
                const loadingContainer = document.getElementById('loadingContainer');
                const errorContainer = document.getElementById('errorContainer');
                const emptyContainer = document.getElementById('emptyContainer');
                
                loadingContainer.classList.add('hidden');
                errorContainer.classList.add('hidden');
                
                if (this.filteredDirigenti.length === 0) {
                    container.classList.add('hidden');
                    emptyContainer.classList.remove('hidden');
                    return;
                }
                
                emptyContainer.classList.add('hidden');
                container.classList.remove('hidden');

                // Genera HTML per ogni dirigente
                container.innerHTML = this.filteredDirigenti.map((dirigente, index) => 
                    this.createDirigenteCard(dirigente, index)
                ).join('');

                // Anima le card
                this.animateCards();
            }

            // Crea singola card dirigente
            createDirigenteCard(dirigente, index) {
                const initials = dirigente.nome_cognome 
                    ? dirigente.nome_cognome.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2)
                    : '??';
                
                const roleClass = this.getRoleClass(dirigente.ruolo);
                const provincia = dirigente.provincia || 'Non specificata';
                
                return `
                    <div class="dirigente-card fade-in-up" 
                         style="animation-delay: ${index * 0.1}s; opacity: 0;"
                         tabindex="0"
                         role="article"
                         aria-label="Informazioni su ${dirigente.nome_cognome}">
                        
                        <!-- Avatar -->
                        <div class="dirigente-avatar">
                            ${dirigente.foto_url ? 
                                `<img src="${dirigente.foto_url}" alt="${dirigente.nome_cognome}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">` :
                                `${initials}`
                            }
                        </div>
                        
                        <!-- Nome -->
                        <h3 class="dirigente-title">
                            ${dirigente.nome_cognome || 'Nome non disponibile'}
                        </h3>
                        
                        <!-- Badge Ruolo -->
                        <div style="text-align: center; margin-bottom: 1rem;">
                            <span class="role-badge ${roleClass}">
                                ${dirigente.ruolo || 'Ruolo non specificato'}
                            </span>
                        </div>
                        
                        <!-- Provincia -->
                        <div class="dirigente-location">
                            📍 ${provincia}
                        </div>
                        
                        <!-- Contatti -->
                        <div class="contact-buttons">
                            ${dirigente.email ? 
                                `<a href="mailto:${dirigente.email}" 
                                   class="contact-button btn-email"
                                   aria-label="Invia email a ${dirigente.nome_cognome}">
                                    📧 Email
                                </a>` : ''
                            }
                            ${dirigente.telefono ? 
                                `<a href="tel:${dirigente.telefono}" 
                                   class="contact-button btn-phone"
                                   aria-label="Chiama ${dirigente.nome_cognome}">
                                    📞 Chiama
                                </a>` : ''
                            }
                        </div>
                    </div>
                `;
            }

            // Ottieni classe CSS per il ruolo
            getRoleClass(ruolo) {
                if (!ruolo) return 'role-provinciale';
                
                if (ruolo.toLowerCase().includes('regionale')) return 'role-regionale';
                if (ruolo.toLowerCase().includes('provinciale')) return 'role-provinciale';
                return 'role-provinciale';
            }

            // Anima le card con effetto stagger
            animateCards() {
                const cards = document.querySelectorAll('.dirigente-card');
                cards.forEach((card, index) => {
                    setTimeout(() => {
                        card.style.opacity = '1';
                    }, index * 100);
                });
            }

            // Aggiorna statistiche
            updateStats() {
                const total = this.allDirigenti.length;
                const regionali = this.allDirigenti.filter(d => 
                    d.ruolo && d.ruolo.toLowerCase().includes('regionale')
                ).length;
                const provinciali = this.allDirigenti.filter(d => 
                    d.ruolo && d.ruolo.toLowerCase().includes('provinciale')
                ).length;
                
                document.getElementById('totalCount').textContent = total;
                document.getElementById('regionaliCount').textContent = regionali;
                document.getElementById('provincialiCount').textContent = provinciali;
            }

            // Filtra dirigenti
            filterDirigenti() {
                const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
                
                this.filteredDirigenti = this.allDirigenti.filter(dirigente => {
                    // Ricerca testuale
                    const matchesSearch = !searchTerm || 
                        (dirigente.nome_cognome && dirigente.nome_cognome.toLowerCase().includes(searchTerm)) ||
                        (dirigente.provincia && dirigente.provincia.toLowerCase().includes(searchTerm)) ||
                        (dirigente.ruolo && dirigente.ruolo.toLowerCase().includes(searchTerm));
                    
                    // Filtro per ruolo
                    const matchesFilter = this.currentFilter === 'all' || 
                        (dirigente.ruolo && dirigente.ruolo.toLowerCase().includes(this.currentFilter.toLowerCase()));
                    
                    return matchesSearch && matchesFilter;
                });
                
                this.renderDirigenti();
            }

            // Setup event listeners
            setupEventListeners() {
                // Ricerca con debounce
                let searchTimeout;
                document.getElementById('searchInput').addEventListener('input', () => {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => this.filterDirigenti(), 300);
                });

                // Tab filtri
                document.querySelectorAll('.filter-tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        // Aggiorna tab attiva
                        document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                        
                        // Aggiorna filtro
                        this.currentFilter = tab.dataset.filter;
                        this.filterDirigenti();
                    });
                });
            }

            // Setup sidebar (solo desktop)
            setupSidebar() {
                const sidebar = document.getElementById('smartSidebar');
                const sidebarTrigger = document.getElementById('sidebarTrigger');
                
                if (!sidebar || !sidebarTrigger) return;
                
                let isMouseOnLeft = false;
                let scrollTimer = null;
                
                // Mouse detection per il lato sinistro
                sidebarTrigger.addEventListener('mouseenter', () => {
                    if (window.innerWidth >= 1024) {
                        isMouseOnLeft = true;
                        sidebar.classList.add('visible');
                        setTimeout(() => {
                            sidebar.classList.add('active');
                        }, 100);
                    }
                });

                sidebarTrigger.addEventListener('mouseleave', () => {
                    if (window.innerWidth >= 1024) {
                        isMouseOnLeft = false;
                        setTimeout(() => {
                            if (!sidebar.matches(':hover')) {
                                sidebar.classList.remove('active');
                                sidebar.classList.remove('visible');
                            }
                        }, 200);
                    }
                });

                sidebar.addEventListener('mouseenter', () => {
                    if (window.innerWidth >= 1024) {
                        sidebar.classList.add('active');
                    }
                });

                sidebar.addEventListener('mouseleave', () => {
                    if (window.innerWidth >= 1024 && !isMouseOnLeft) {
                        sidebar.classList.remove('active');
                        sidebar.classList.remove('visible');
                    }
                });
            }

            // Funzione pubblica per ricaricare
            async reload() {
                await this.loadDirigenti();
            }
        }

        // Inizializzazione
        document.addEventListener('DOMContentLoaded', () => {
            window.dirigentiManager = new DirigentiManager();
        });

        // Error handling globale
        window.addEventListener('error', (e) => {
            console.error('💥 Errore globale:', e.error);
        });
    </script>

</body>
</html>
